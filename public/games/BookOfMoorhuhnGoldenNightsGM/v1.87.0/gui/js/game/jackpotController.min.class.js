/**
 * class for handling the jackpot features (red hot firepot, golden nights) of gamomat slotmachines
 * @copyright LoCoNET GmbH 2016-09-28
 */function JackpotController(e){function yt(){Y.css("opacity",0).removeClass("hidden").show(),s.load({name:a.playoutSignConfig.environment,divID:"jpSignAnim",scale:.5*w}),s.load({name:a.playoutSignConfig.environment+"Highlight",divID:"jpSignAnimHighlight",scale:.5*w}),vt&&s.load({name:vt.general.environment,divID:"playoutTextBox"}),Y.hide().css("opacity","");var e={};for(var t in a.playoutPictures)e[t]=E+a.playoutPictures[t];s.storeImages(e)}function bt(){var e=E+"anim/",t=a.playoutPlaqueAnims,n=function(){var r=t.shift();if(!r)return;var i=t.length?n:function(){l=!0};r.params.type==="sweep"&&(r.params.onEnd=function(){O=!1});var o=$.isArray(r.params.spritesheets)?r.params.spritesheets:r.params.spritesheets[w];for(var u in o)o[u]=e+o[u];r.params.spritesheets=o,typeof r.params.scale!="undefined"&&w==1&&(r.params.scale/=2),s.storeSymbolAnim(r.name,r.params,i)};t.length&&n()}function wt(e,t){var n=Date.now()+t;r.add("jackpotDelay-"+gt++,function(){return Date.now()<n?!0:(typeof e=="function"&&e(),!1)})}function Et(){if(X)return!1;if(j>=a.maxWinPoints)return!1;H||xt();var e=Date.now(),t=e-D;D=e;if(B>=0)return B-=t,!0;if(P<=dt[F])return P=dt[F],!0;P-=t*H,P<dt[F]&&(P=dt[F]);var n=~~P;return St(n),!0}function St(e){it.css({top:e});var t=!1;while(e<=dt[j+1])j++,t||(t=!0);t&&(xt(),R<j&&(R=j),G.updateConsole({type:"points",value:R}));var r=-1;for(var i in a.pointsNeededForWinLevel)j>=a.pointsNeededForWinLevel[i]&&(r=i);if(r>J){var o={};o[r]=!0,J>=0&&(o[J]=!1);if(typeof a.inactiveWinsPerBetLevel[x]=="undefined"||!a.inactiveWinsPerBetLevel[x][r])O=!0,s.changeJackpotPlayoutSituation({actWinValue:o,sweep:r}),vt&&(Tt({textname:vt.winLevels[r].metalTextname,howOften:2,interval:70}),n.play({playwhat:vt.winLevels[r].sound}));J=r}}function xt(){H=typeof dt[j+1]!="undefined"?(dt[j]-dt[j+1])/_:(dt[0]-dt[1])/_}function Tt(e){var t="normal",n=typeof e.interval!="undefined"?e.interval:100,r=Date.now()+n,i=typeof e.howOften!="undefined"?2*e.howOften:4;A=!1;var o=function(u){var a=Date.now();if(!i||A){typeof e.useDomElement!="undefined"&&e.useDomElement.removeClass("flickering");return}if(a<r){requestAnimationFrame(o);return}i>0&&i--,typeof e.useDomElement!="undefined"?e.useDomElement.toggleClass("flickering"):(t=t=="normal"?"shine":"normal",s.changeTextColor(e.textname,t)),r=a+n,requestAnimationFrame(o)};requestAnimationFrame(o)}function Nt(){at=!1,Y.find(".jpChance .chanceItem, .jpChance .chanceItemSuccessSign").removeClass("win lose").removeAttr("style"),Y.find(".jackpotFeatureContainer").show(),Y.find(".bgAnim, .jpSign").hide(),Y.removeClass("hidden").show(),n.play({playwhat:"jackpotStart"}),wt(Ct,1600),C="chance"}function Ct(){var e=Y.find(".chanceAnim"),t=!1,r=function(r){if(t)return;if(r>0&&!N[r-1])t=!0,kt();else{N[r]?n.play({playwhat:"jackpotChanceWin"+(r+1),soundLine:r==1?"fg2":"fg1"}):n.play({playwhat:"jackpotChanceNoWin",soundLine:r-1==1?"fg1":"fg2"});var s=Y.find(".jpChance #chanceItem-"+r),o=s.css("left"),u=s.css("top");if(S){var f={loop:!1,dontClearDrawContainer:!0};typeof a.playoutSignConfig.frameForChanceSuccessSign!="undefined"&&(f.onFrame={},f.onFrame[a.playoutSignConfig.frameForChanceSuccessSign]=function(){Y.find(".jpChance #chanceItem-"+r+"-sign").addClass(N[r]?"win":"lose")}),i.play(N[r]?a.chanceAnimPrefix+"Win":a.chanceAnimPrefix+"Lose",[{x:parseInt(o.substr(0,o.length-2)),y:parseInt(u.substr(0,u.length-2)),elem:s}],f,e)}else{var l="chanceItem-"+r,c="chanceItemAnim-"+r;e.append('<div class="chanceItemAnim '+(N[r]?"win":"lose")+'" id="'+c+'"></div>');var h=Y.find("#"+l),p=Y.find("#"+l+"-sign"),d=Y.find("#"+c);ht["chanceItemAnim"+r]={domElems:[d],fadeOutElems:[h],duration:800,callback:function(){h.css("opacity","").addClass(N[r]?"win":"lose"),p.addClass(N[r]?"win":"lose"),d.css("opacity",0)}},d.css({left:o,opacity:0}),Vt()}}};st=[[0,function(){r(0)}],[1e3,function(){r(1)}],[2e3,function(){r(2)}]],ot=null;for(var s in a.playoutSignAnimConfigData){var o=a.playoutSignAnimConfigData[s];o[2]==="firstAnim"?function(e){st.push([o[0],function(){if(N[0]&&N[1]&&N[2]){n.play({playwhat:"jackpotSign"});if(S)for(var t in e){var r=e[t];for(var s=0;s<r.length;s++)i.play(t,[r[s]],{loop:!1,dontClearDrawContainer:!0},Z)}}else kt()}])}(o[1]):o[2]==="showSign"?st.push([o[0],At]):typeof o[1]!="undefined"?function(e){st.push([o[0],function(){if(S)for(var t in e){var n=e[t];for(var r=0;r<n.length;r++)i.play(t,[n[r]],{loop:!1,dontClearDrawContainer:!0},Z)}}])}(o[1]):st.push(o)}Xt()}function kt(e){typeof e=="undefined"&&(e=!1),e?(n.stop("fg1"),n.stop("fg2")):n.getActiveSound("fg2")=="jackpotChanceNoWin"?n.fadeToStopFgSound(500,"fg2"):n.fadeToStopFgSound(500,"fg1"),S&&(i.stop(a.chanceAnimPrefix+"Win"),i.stop(a.chanceAnimPrefix+"Lose")),Y.find(".chanceAnim").html("");for(var t=0;t<=2;t++)Y.find('.jpChance [id^="chanceItem-'+t+'"]').css("opacity","").addClass(N[t]?"win":"lose");at=!0;var s=N[0]&&N[1]&&N[2],o=s?500:1500,u=Date.now();r.add("jackpotChanceItemFinish",function(){return Date.now()-u<o?!0:(s?At():Wt(),!1)})}function Lt(){at=!0,Wt()}function At(){Y.find(".jpChance").addClass("fadeOutSlow"),s.clear(a.playoutSignConfig.environment),s.clear(a.playoutSignConfig.environment+"Highlight"),Y.find(".jpSign .jpOutroSignText").hide();var e=obj_lang.game_jackpot_intro,t={anim:a.playoutSignConfig.environment,textname:a.playoutSignConfig.textname,textblocks:e,fontfamily:"Roboto Condensed, Arial, Sans-Serif",fontweight:"bold",fontsize:135,maxWidth:960,top:e.length==1?210:140,fill:a.playoutSignConfig.colors.normal.fill,stroke:a.playoutSignConfig.colors.normal.stroke,strokeThickness:4};s.addTextToAnim(t),t.anim=a.playoutSignConfig.environment+"Highlight",t.fill=a.playoutSignConfig.colors.shine.fill,t.stroke=a.playoutSignConfig.colors.shine.stroke,s.addTextToAnim(t),Tt({howOften:-1,interval:230,useDomElement:Y.find("#jpSignAnimHighlight")}),Y.find(".jpSign").removeClass("outro").show(),typeof G.onPlayoutIntroSign=="function"?G.onPlayoutIntroSign(Ot):Ot()}function Ot(){$(".container").removeClass("chance").addClass("playout"),Y.find(".chanceAnim").html(""),s.clear(a.playoutSignConfig.environment),s.clear(a.playoutSignConfig.environment+"Highlight"),A=!0,Y.find("#jpSignAnimHighlight").removeClass("flickering"),ft?at=!0:at=!1,G.updateConsole({type:"empty"}),Mt(),r.pauseRegExp("animateMode1*"),r.pauseRegExp("animateMode2*"),r.pause("winline");var e=function(){it.css({top:dt[0]}),D=Date.now(),X=!1,r.add("checkJackpotThermometer",Et);var e=Y.find(".bgAnim");e.removeClass("hidden").show(),typeof a.startPlayoutBGAnim=="function"&&a.startPlayoutBGAnim(e,!S),n.stop("fg2");var t=function(){var e=0,r=function(i){e++,n.playBgSound("jackpotBackgroundLoop"+i,function(){e>=4?t():e>=2?r(2):r(1)},!0)};r(1)};T.startPoints&&(R=T.startPoints,G.updateConsole({type:"bonusPoints",value:R})),n.isBgMuted()&&n.unmuteBgSound(),n.playBgSound("jackpotBackgroundIntro",t,!1),wt(function(){T.startPoints?($("#jackpotBonusFlySymbol").show().addClass("animating symbol-"+T.startPoints),wt(function(){n.play({playwhat:"jackpotFlyingNumber",soundLine:"fg1"}),$("#jackpotBonusFlySymbol").hide().removeClass("animating symbol-2 symbol-5"),j=T.startPoints,F=T.startPoints,P=dt[j],wt(function(){St(P),G.updateConsole({type:"points",value:R})},100),Pt()},800)):Pt()},1397)};_t(e),typeof G.onPlayoutStart=="function"&&G.onPlayoutStart()}function Mt(){Y.find(".bgDarkening, .bgControlBox, .jpSign, .jpChance").hide(),Y.find(".jpPlayout").addClass("betLevel-"+x),Y.find(".bgAnim, .bgHeadline, .jpPlayout").show();if(vt){var e=function(){var e={};for(var t in vt.winLevels)e[t]={textname:vt.winLevels[t].winValueTextname,textcontent:vt.winLevels[t].winValue,metalTextname:vt.winLevels[t].metalTextname,inactive:typeof a.inactiveWinsPerBetLevel[x]!="undefined"&&a.inactiveWinsPerBetLevel[x][t]};s.resetJackpotPlayoutValues(e)};L?e():(s.loadJackpotPlayoutScreen(vt,!S),r.add("waitForJackpotPlayoutAnims",function(){return l?(s.addJackpotPlayoutAnims(vt,e),!1):!0}),L=!0)}Y.show()}function _t(e){var t=Dt(T.initSymbols);y?(f.resetValues(t),e()):(f.initValues(e,t),y=!0)}function Dt(e){var t=p.charCodeAt(0),n={};d=0,U=0;for(var r in e){var i=0,s={};for(var o in e[r])s[i]=h[e[r][o]],i++;n[String.fromCharCode(t+parseInt(r))]=s,d++}return n}function Pt(){var e=Dt(T.spinSymbols);G.updateConsole({type:"empty"}),f.setSpinResult({onEnd:Ft,onReelStopped:Ht,onReelFinished:Bt},{reelSymbols:e,prestamp:!1},{quickStopData:null,dontBounce:null})}function Ht(){if(U<d)if(W[U])jt(U);else{if(n.getActiveSound("fg1")=="jackpotFlyingNumber"){var e=n.getActiveSound("fg2");(!e||e.substr(0,11)!=="jackpotFill")&&n.stop("fg2")}n.playGeneric("jackpotReelStop")}}function Bt(){U<d&&(W[U]||qt(U),U++)}function jt(){n.play({playwhat:"jackpotQuestionmarkTeaser"}),lt||(lt=!0);var e=String.fromCharCode(p.charCodeAt(0)+U);if(S)i.play("featureSymbolTeaser",[{x:(v+g)*U,y:0,elem:"#reel_"+e+"_1"}],{loop:!1,onFrame:{36:function(){ct--;if(ct==0){var e=Date.now(),t=function(){return Date.now()-e<200?!0:(lt=!1,!1)};r.add("waitForTeaserAnimEnd",t)}}}},rt);else{var t=[];rt.find("#teaserAnim-"+U+" div").each(function(){t.push($(this))}),ht["teaserAnim"+U]={domElems:t,duration:450,callback:function(){ct--,ct==0&&(lt=!1)}},Vt()}}function Ft(){var e=function(){if(lt)return!0;if(!W[d-1]&&j<q)return!0;for(var e in W)if(W[e]){W[e]=!1,It(e);break}return!1};r.add("checkForTransformationStart",e)}function It(e){n.play({playwhat:"jackpotQuestionmarkValue",soundLine:"fg1"});var t=String.fromCharCode(p.charCodeAt(0)+parseInt(e)),r=function(){qt(e);var t=!1;for(var n in W)if(W[n]){t=n,W[n]=!1;break}t&&Rt(F+z[e],function(){It(t)})};if(S)i.play("featureSymbolTransform",[{x:(v+g)*e,y:0,elem:$("#reel_"+t+"_1")}],{loop:!1,onFrame:{54:function(){Y.find("#endSymbol-"+e+" .transformedSymbol").addClass("fadeIn symbol-"+z[e])}},onEnd:r},rt);else{var s=Y.find("#endSymbol-"+e);s.addClass("optBG").css("opacity",0),s.find(".transformedSymbol").addClass("symbol-"+z[e]).css("opacity",1),ht["transformAnim"+e]={domElems:[s],callback:r,duration:1500},Vt()}}function qt(e){var t=z[e];wt(function(){n.play({playwhat:"jackpotFlyingNumber",soundLine:"fg1"}),wt(function(){F+=t},200)},Q[e]),Y.find("#endSymbol-"+e+" .flySymbol").addClass("animating symbol-"+t),K++,K>=d&&Ut()}function Rt(e,t){var n=function(){return j<e?!0:O?!0:(t(),!1)};r.add("checkForEvaluateReelSymbolEnd",n)}function Ut(){var e=function(){var e=[],t=V;S||(V<=1?t=0:V<=4?t=3:V==5?t=5:t=6);for(var r in a.winSoundConfigData[t])for(var i=1;i<=a.winSoundConfigData[t][r].amount;i++)e.push(a.winSoundConfigData[t][r].name);var s=-1,o=function(){s++;var r=e[s].indexOf("Intro")>=0||e[s].indexOf("Loop")>=0;n.play({playwhat:e[s],callback:function(){e.length-1==s?typeof a.delayAfterWinSound[t]!="undefined"?wt(Wt,a.delayAfterWinSound[t]):Wt():o()},soundLine:"fg1",loop:r})};o()};Rt(I,function(){C="playoutWin",X=!0,n.stopBgSound(),wt(function(){Y.find(".jpSign").addClass("outro").show(),e(),s.changeJackpotPlayoutSituation({win:V});var t=Date.now(),n=function(){return k?!1:C?Date.now()-t<a.delayBeforeWinAnim?!0:(zt(),a.stopPlayoutBGAnim("showWinAnim"),mt&&(st=typeof mt.all!="undefined"?mt.all:mt[V],st&&(ot=typeof a.winAnimZIndexByLayer!="undefined"&&a.winAnimZIndexByLayer[V]!=="undefined"?a.winAnimZIndexByLayer[V]:null,et.show(),Xt("winAnim"))),!1):!1};r.add("checkForShowOutroSign",n),typeof G.onAbortableAnim=="function"&&G.onAbortableAnim()},300)})}function zt(){Y.find(".jpSign .jpOutroSignText").show();var e=a.playoutSignConfig.outro,t={anim:a.playoutSignConfig.environment,textname:a.playoutSignConfig.textname,textblocks:obj_lang.game_jackpot_outro,fontfamily:"Roboto Condensed, Arial, Sans-Serif",fontweight:"bold",fontsize:e.sloganFontsize,maxWidth:960,top:e.sloganTop,fill:a.playoutSignConfig.colors.normal.fill,stroke:a.playoutSignConfig.colors.normal.stroke,strokeThickness:4};s.addTextToAnim(t),t.anim=a.playoutSignConfig.environment+"Highlight",t.fill=a.playoutSignConfig.colors.shine.fill,t.stroke=a.playoutSignConfig.colors.shine.stroke,s.addTextToAnim(t),Tt({howOften:-1,interval:230,useDomElement:Y.find("#jpSignAnimHighlight")});var n=Y.find(".jpSign #jpOutroSignWinLevel");n.hasClass("needsToBeLoaded")&&(s.load({name:"jpPlayoutOutroSign",divID:"jpOutroSignWinLevel",scale:.5*w}),n.removeClass("needsToBeLoaded")),s.clear("jpPlayoutOutroSign"),typeof e[V]!="undefined"&&(e=e[V]);var r=typeof e.fontsize!="undefined"?e.fontsize:56,i={anim:"jpPlayoutOutroSign",text:vt.winLevels[V].metalText,fontfamily:"Roboto Condensed, Arial, Sans-Serif",fontweight:"bold",fontsize:r,fill:"#000000",blur:1*w,"static":!0};typeof e.shadow!="undefined"&&(typeof e.shadow.offsetTop!="undefined"&&(i.extraOffsetTop=e.shadow.offsetTop[w]),typeof e.shadow.offsetLeft!="undefined"&&(i.extraOffsetLeft=e.shadow.offsetLeft[w])),s.addTextToAnim(i);var o={anim:"jpPlayoutOutroSign",text:vt.winLevels[V].metalText,fontfamily:"Roboto Condensed, Arial, Sans-Serif",fontweight:"bold",fontsize:r,fill:vt.winLevels[V].metalColors.normal.fill,stroke:vt.winLevels[V].metalColors.normal.stroke,strokeThickness:4,"static":!0};S&&(o.resolution=1.75),typeof e.text!="undefined"&&(typeof e.text.offsetTop!="undefined"&&(o.extraOffsetTop=e.text.offsetTop[w]),typeof e.text.offsetLeft!="undefined"&&(o.extraOffsetLeft=e.text.offsetLeft[w])),s.addTextToAnim(o),Y.find(".jpSign #jpOutroSignWinLevel").removeClass().addClass("jpOutroSignText level-"+V);var u=vt.winLevels[V].winValue;Y.find(".jpSign #jpOutroSignWinValue").html(displayMoney(u)),Y.find(".jpPlayout").addClass("fadeOutSlow"),Y.find(".bgHeadline").addClass("fadeOutSlow"),Y.find(".jpSign").addClass("fadeInSlow"),wt(function(){s.changeJackpotPlayoutSituation({stopAnims:!0})},800)}function Wt(){if(!b)return;b=!1,t.close(),typeof G.onEnd=="function"&&G.onEnd(V>=0?V:!1)}function Xt(e){typeof e=="undefined"&&(e="featureAnim");var t=0,n=Date.now(),s=st[0][0],o=0,u=function(){if(at)return $t(),!1;if(Date.now()+s>=o){if(typeof st[t][1]!="undefined"){var r=st[t][1];if(typeof r=="function")r();else if(typeof r=="object")for(var u in r)for(var a in r[u]){var f=r[u][a];if(typeof f.notAnimate!="undefined"&&f.notAnimate){var l=nt[u];ot&&l.css({"z-index":typeof f.layerIndex!="undefined"&&typeof ot[f.layerIndex]!="undefined"?ot[f.layerIndex]:""}),l.addClass("visible")}else{if(u=="goldennightsFountain1"||u=="goldennightsFountain3"||u=="goldennightsFountain4")break;var c=Z;e==="winAnim"&&(ot&&typeof f.layerIndex!="undefined"&&typeof ot[f.layerIndex]!="undefined"?c=tt[ot[f.layerIndex]]:c=et),i.play(u,[f],{loop:!1,dontClearDrawContainer:!0},c)}}}++t;if(t==st.length)return $t(),!1;o=n+st[t][0]}return!0};ft=!0,r.add("jackpotAnims",u)}function Vt(){var e=function(){if(at)return pt=0,Jt(),!1;for(var e in ht){typeof ht[e].startTime=="undefined"&&(ht[e].startTime=Date.now());var t=typeof ht[e].duration!="undefined"?ht[e].duration:1e3,n=0,r=Date.now()-ht[e].startTime;r<t?n=r/t:n=1,ht[e].domElems[0].css({opacity:n}),typeof ht[e].fadeOutElems!="undefined"&&typeof ht[e].fadeOutElems[0]!="undefined"&&ht[e].fadeOutElems[0].css({opacity:1-n}),n==1&&(ht[e].domElems.length>1?(ht[e].domElems.shift(),ht[e].startTime=Date.now()):(pt--,typeof ht[e].callback=="function"&&ht[e].callback(),delete ht[e]))}return pt?!0:(Jt(),!1)};pt++,ft=!0,r.add("jackpotOptAnims",e)}function $t(){at=!1,ft=!1,st={},ot=null,Z.html(""),et.find(".jpSymbolAnimLayer").html(""),ut!==null&&(ut(),ut=null)}function Jt(){ft=!1,ht={}}function Kt(e,t,n){s.load({name:"jpInfoSign",divID:"jackpotWinMetal",scale:.5*w}),typeof n=="function"&&n()}function Qt(e,t){var n=t.find(".jackpotWin"),r=n.find(".value"),i="";for(var s=0;s<=a.maxBetLevel;s++)i+=" level-"+s;var o=function(s,o){var u=e.topWinOnHighestLevel,f=-1;for(var l in s)s[l]>f&&(f=s[l]);t.addClass("level-"+f),typeof e.allTopWins!="undefined"&&(u=e.allTopWins[e.betsPerLevel[f]]);var c="default";s.length===1&&typeof a.betInfoWinValueConfig[s[0]]!="undefined"&&(c=s[0]),r.html(displayMoney(u));var h=n.width(),p=~~(1.03*r.outerWidth());if(p>h){var d=a.betInfoWinValueConfig[c].maxWidth;if(p>d){var v=parseInt(r.css("font-size")),m=v,g=0;while(p>d&&g<100)m--,r.css("font-size",m),p=~~(1.03*r.outerWidth()),g++;a.betInfoWinValueConfig[c].fontsizeWinValue=m,c==="default"&&(a.betInfoWinValueConfig[c].fontsizeMetal=m),a.betInfoWinValueConfig[c].paddingTop=v-m}a.betInfoWinValueConfig[c].width=p}r.css("font-size",""),t.removeClass(i),typeof o=="function"&&o()},u=[],f=[];for(var l in e.betsPerLevel)typeof a.betInfoWinValueConfig[l]!="undefined"?u.push([l]):f.push(l);u.push(f);var c=function(){if(!u.length){t.addClass("level-"+e.betLevel);return}var n=u.shift();o(n,c)};c()}var t=this,n=null,r=null,i=null,s=null,o=null,u=null,a=null,f=null,l=!1,c=!1,h={1:"/symbol-1.png",2:"/symbol-2.png",3:"/symbol-3.png",4:"/symbol-4.png",5:"/symbol-5.png",6:"/symbol-6.png",7:"/symbol-7.png",8:"/symbol-8.png",9:"/symbol-9.png",10:"/symbol-10.png",11:"/symbol-11.png",12:"/symbol-12.png",13:"/symbol-13.png",14:"/symbol-14.png",15:"/symbol-15.png",100:"/symbol-question.jpg"},p="v",d=0,v=152,m=112,g=12,y=!1,b=!1,w=1,E="",S=!0,x=0,T={},N=!1,C=!1,k=!1,L=!1,A=!1,O=!1,M=!1,_=200,D=0,P=0,H=0,B=-1,j=0,F=0,I=0,q=0,R=0,U=0,z={},W={},X=!1,V=-1,J=-1,K=0,Q={0:500,1:500,2:630,3:700,4:730},G={onInit:null,onPlayoutIntroSign:null,onPlayoutStart:null,onEnd:null,onAbortableAnim:null,updateConsole:function(){}},Y=null,Z=null,et=null,tt={},nt={},rt=null,it=null,st={},ot=null,ut=null,at=!1,ft=!1,lt=!1,ct=0,ht={},pt=0,dt=null,vt=null,mt=null,gt=0;(function(e){obj_timer=Timer_getInstance(),n=e.sound,r=e.animManager,s=e.pixiManager,i=e.symAnimHandler,o=e.loader,u=e.conf,w=u.mode("r")==0?2:1,S=u.playSymbolAnims(),E=e.pixiAssetPath,$(".container").addClass(e.jackpotType),Y=$(".jackpotContainer"),Z=Y.find(".featureAnim"),et=Y.find(".winAnimContainer").hide(),rt=Y.find(".reelSymbolAnim"),it=Y.find(".thermometer .filling"),a=new JackpotConfig({animManager:r,symAnimHandler:i,resolFactor:w,soundManager:n,delayActionHandler:wt,jpContainer:Y}),vt=a.playoutConfig,S?mt=a.winAnimConfigData:a.optimalSlotWinAnimConfigData&&(mt=a.optimalSlotWinAnimConfigData),dt=a.thermometerFill,g=a.reelSymbolSpace;var t=$(".jackpotContainer .jackpotInfoContainer .jpIntro .jackpotButtonBox");for(var l=0;l<=a.maxBetLevel+1;l++)t.append('<div class="jackpotButton layer-'+l+" jackpotButton-"+l+(l>0?" invisible":"")+'"></div>');if(w==1){for(var c in dt)dt[c]=~~(dt[c]/2+.5);v=~~(v/2),m=~~(m/2),g=~~(g/2+.5);if(mt)for(var h in mt)for(var d in mt[h])for(var y in mt[h][d][1])for(var b in mt[h][d][1][y]){var x=mt[h][d][1][y][b];x.x=~~(x.x/2),x.y=~~(x.y/2)}if(vt){typeof vt.general.bgMetalOffsetX!="undefined"&&(vt.general.bgMetalOffsetX=vt.general.bgMetalOffsetX/2,vt.general.bgMetalOffsetY=vt.general.bgMetalOffsetY/2),vt.general.fontSize=vt.general.fontSize/2,vt.general.strokeThickness=vt.general.strokeThickness/2,vt.general.textHeight=vt.general.textHeight/2,vt.general.textLeft.metal=vt.general.textLeft.metal/2,vt.general.textLeft.winValue=vt.general.textLeft.winValue/2,vt.general.textWidth.metal=vt.general.textWidth.metal/2,vt.general.textWidth.winValue=vt.general.textWidth.winValue/2,vt.general.winValues.paddingRight=vt.general.winValues.paddingRight/2,vt.general.metalShadow.offsetX=vt.general.metalShadow.offsetX/2,vt.general.metalShadow.offsetY=vt.general.metalShadow.offsetY/2;for(var c in vt.winLevels)vt.winLevels[c].top=vt.winLevels[c].top/2,typeof vt.winLevels[c].bgMetalOffsetX!="undefined"&&(vt.winLevels[c].bgMetalOffsetX=vt.winLevels[c].bgMetalOffsetX/2),typeof vt.winLevels[c].bgMetalOffsetY!="undefined"&&(vt.winLevels[c].bgMetalOffsetY=vt.winLevels[c].bgMetalOffsetY/2);for(var l in a.playoutSignAnimConfigData)for(var T in a.playoutSignAnimConfigData[l][1]){var N=a.playoutSignAnimConfigData[l][1][T];for(var C in N)N[C].x=~~(N[C].x/2),N[C].y=~~(N[C].y/2)}}}typeof a.preparePayoutBGAnim=="function"&&a.preparePayoutBGAnim(Y.find(".bgAnim")),yt();if(typeof a.winAnimZIndexByLayer!="undefined"&&typeof a.winAnimZIndexByLayer.symbolAnimIndexes!="undefined")for(var l in a.winAnimZIndexByLayer.symbolAnimIndexes){var k=a.winAnimZIndexByLayer.symbolAnimIndexes[l];tt[k]=$('<div class="jpSymbolAnimLayer layer-'+k+' fullSize"></div>').appendTo(et)}for(var l in mt)for(var L in mt[l])for(var T in mt[l][L])if(typeof mt[l][L][T]=="object")for(var y in mt[l][L][T]){var A=mt[l][L][T][y][0];typeof A.notAnimate!="undefined"&&A.notAnimate&&typeof nt[y]=="undefined"&&(nt[y]=$('<div class="featureAnimPic '+y+'"></div>'),nt[y].css({left:A.x,top:A.y}).appendTo(et))}typeof e.onInit=="function"&&(G.onInit=e.onInit),typeof e.onAbortableAnim=="function"&&(G.onAbortableAnim=e.onAbortableAnim),typeof e.onPlayoutIntroSign=="function"&&(G.onPlayoutIntroSign=e.onPlayoutIntroSign),typeof e.onPlayoutStart=="function"&&(G.onPlayoutStart=e.onPlayoutStart),typeof e.onEnd=="function"&&(G.onEnd=e.onEnd),typeof e.updateConsole=="function"&&(G.updateConsole=e.updateConsole),f=new ReelEngine({sound:n,cache:o,conf:u,animManager:r,finishListener:!0,container:"jackpot_reel_container",size:{w:v,h:m},reelSpace:g,speed:15,rows:1,firstReel:p,symbols:["/symbol-1.png","/symbol-2.png","/symbol-3.png","/symbol-4.png","/symbol-5.png","/symbol-6.png","/symbol-7.png","/symbol-8.png","/symbol-9.png","/symbol-10.png","/symbol-11.png","/symbol-12.png","/symbol-13.png","/symbol-14.png","/symbol-15.png","/symbol-question.jpg"]}),f.init()})(e),this.init=function(e,t,n){c=!!n,x=t,typeof G.onInit=="function"&&G.onInit(),l||bt(),T=e.result;if(typeof T!="undefined"){N=T.chance,z=T.pointsPerReel,W=T.transformReels,j=0,k=!1,R=0,F=0,I=T.startPoints,q=T.startPoints;for(var r in z)I+=z[r],W[r]||(q+=z[r]);I>a.maxWinPoints&&(I=a.maxWinPoints),V=-1;var i=-1;if(typeof T.totalWin!="undefined")for(var s in a.pointsNeededForWinLevel){if(a.pointsNeededForWinLevel[s]>I)break;i++;if(typeof a.inactiveWinsPerBetLevel[x]=="undefined"||!a.inactiveWinsPerBetLevel[x][i])V=i}for(var s in T.levelWinValues)vt.winLevels[s].winValue=T.levelWinValues[s];for(var o in W)W[o]&&ct++}b=e.actStep==1?"chance":e.actStep==2?"playout":!1,$(".container").addClass("inJackpotMode "+b),$(".gameContainer .backBox").hide(),b=="chance"?Nt():b=="playout"&&Ot()},this.abortAnim=function(){k=!0;if(C==0)return;C=="chance"?kt(!0):C=="playoutWin"&&Lt(),C=!1},this.close=function(){n.stop("fg1"),a.stopPlayoutBGAnim("closeFirepot",!S),(!c||b!="chance")&&G.updateConsole({type:"empty"}),s.changeJackpotPlayoutSituation({stopAnims:!0}),A=!0,Y.find("#jpSignAnimHighlight").removeClass("flickering"),J=-1,K=0,r.resumeAll(),Y.hide(),Y.find(".jpChance, .jpPlayout, .jpSign").removeClass("fadeInSlow fadeOutSlow"),Y.find(".jpPlayout").removeClass("1 betLevel-2 betLevel-3 betLevel-4"),Y.find(".bgAnim, .bgHeadline, .jpPlayout").hide(),Y.find(".bgHeadline").hide().removeClass("fadeOutSlow"),Y.find(".bgDarkening, .bgControlBox, .jpChance").show(),$(".container").removeClass("inJackpotMode chance playout"),Y.find(".endSymbol").removeClass().addClass("endSymbol"),Y.find(".flySymbol").removeClass().addClass("flySymbol"),Y.find(".transformedSymbol").removeClass().addClass("transformedSymbol"),et.hide();for(var e in nt)nt[e].removeClass("visible");$(".gameContainer .backBox").show(),S||Y.find(".reelSymbolAnim .teaserAnim div").css({opacity:0})},this.showIntroSign=function(e){a.showIntroSign(e)},this.hideIntroSign=function(){a.hideIntroSign()},this.showBetInfoSign=function(e){var t=Y.find(".jackpotInfoContainer"),n=t.find(".jpBetInfo");Y.find(".jackpotFeatureContainer").hide(),t.find(".jpIntro").hide();var r="";for(var i=0;i<=a.maxBetLevel;i++)r+=" level-"+i;n.removeClass(r).addClass("level-"+e.betLevel).show(),t.show(),Y.css("opacity",0).show();var o=function(){Qt(e,n);for(var t in a.betInfoConfig[e.betLevel]){var r=n.find("."+t),i=a.betInfoConfig[e.betLevel][t];if(!i)r.hide();else{switch(t){case"jackpotInfo":n.find(".jackpotInfo .text").html(i.text),typeof i.scalingCallback=="function"&&i.scalingCallback();break;case"jackpotBet":n.find(".jackpotBet .label").html(i),n.find(".jackpotBet .value").html(displayMoney(e.bet));break;case"jackpotBetLevel":n.find(".jackpotBetLevel .label").html(i),n.find(".jackpotBetLevel .value").html(e.betLevel);break;case"jackpotBonus":n.find(".jackpotBonus .label").html(i),n.find(".jackpotBonus .value").text("+"+e.bonus);break;case"jackpotWin":s.clear("jpInfoSign");var o="default";typeof a.betInfoWinValueConfig[e.betLevel]!="undefined"&&(o=e.betLevel);var u=a.betInfoWinValueConfig[o],f={anim:"jpInfoSign",text:vt.winLevels[i].metalText,fontfamily:"Roboto Condensed, Arial, Sans-Serif",fontweight:"bold",fontsize:u.fontsizeMetal,fill:vt.winLevels[i].metalColors.normal.fill,stroke:vt.winLevels[i].metalColors.normal.stroke,strokeThickness:4,"static":!0};S&&(f.resolution=1.75),s.addTextToAnim(f);var l=n.find(".jackpotWin .value");l.html(displayMoney(e.topWin)),l.css({"font-size":typeof u.fontsizeWinValue!="undefined"?u.fontsizeWinValue:"","padding-top":typeof u.paddingTop!="undefined"?u.paddingTop:""}),n.find(".jackpotWin").width(typeof u.width!="undefined"?u.width:"")}r.show()}}Y.css("opacity",""),$(".container").addClass("inJackpotInfoMode")};n.hasClass("needsToBeLoaded")?Kt(e,n,function(){o(),n.removeClass("needsToBeLoaded")}):o()},this.hideBetInfoSign=function(){Y.find(".jackpotInfoContainer").hide(),Y.find(".jackpotInfoContainer .jpBetInfo").removeClass("level-0 level-1 level-2 level-3"),Y.hide(),$(".container").removeClass("inJackpotInfoMode")}};