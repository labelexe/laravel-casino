/**
 * class for handling pixi animations
 * @copyright LoCoNET GmbH 2016-04-15
 */function PixiManager(e){function l(e,t,n){var r=new PIXI.spine.Spine(n[e.name].spineData);r.skeleton.setToSetupPose(),r.update(0),r.autoUpdate=!1,i[e.name].renderer.width<r.width&&r.scale.set(.5,.5),i[e.name].spine=r,typeof e.callback=="function"&&e.callback()}function c(e){if(typeof i[e]=="undefined")return;i[e].renderer.render(i[e].stage)}function h(){if(!n.length)return!1;for(var e in n)c(n[e]);return!0}function p(e){var t=[],n=i[e].spine.spineData.animations;for(var r in n)t.push(n[r].name);return t}function d(e,t,n){typeof n=="undefined"&&(n=1);var r=e.split("-"),i=0;r[0][0]!="#"&&(i=r.shift(),i||(i=-1*r.shift()),i%=360,i<0&&(i+=360));var s=null;switch(i){case 0:s=t.context.createLinearGradient(0,0,t.width,0);break;case 90:s=t.context.createLinearGradient(0,t.height,0,0);break;case 180:s=t.context.createLinearGradient(t.width,0,0,0);break;case 270:s=t.context.createLinearGradient(0,0,0,t.height)}for(var o=0;o<n;o++)for(var u in r){var a=r[u].split(":"),f=(o+a[1]/100)/n;s.addColorStop(f,a[0])}return s}function v(e){var t=1;typeof e.textblocks!="undefined"?(e.text=e.textblocks.join("\n"),t=e.textblocks.length):e.text=e.text.replace(/<br \/>/g,"\n");var n={fontWeight:typeof e.fontweight!="undefined"?e.fontweight+" ":"normal ",fontSize:typeof e.fontsize!="undefined"?e.fontsize:20,fontFamily:typeof e.fontfamily!="undefined"?e.fontfamily:"Arial",fill:typeof e.fill!="undefined"?e.fill:"white",align:typeof e.align!="undefined"?e.align:"center"},r=new PIXI.Text(e.text,n),n=r.style;typeof e.stroke!="undefined"&&(e.stroke[0]=="#"?n.stroke=e.stroke:n.stroke=d(e.stroke,r)),typeof e.strokeThickness!="undefined"&&(n.strokeThickness=e.strokeThickness),typeof e.fill!="undefined"&&(e.fill[0]=="#"?n.fill=e.fill:n.fill=d(e.fill,r,t)),typeof e.lineheight!="undefined"&&(n.lineHeight=e.lineheight);if(typeof e.colors!="undefined"){var i={},s=null;for(var o in e.colors){s||(s=o),i[o]={};for(var a in e.colors[o])e.colors[o][a][0]!="#"?i[o][a]=d(e.colors[o][a],r,t):i[o][a]=e.colors[o][a]}var f=typeof e.textname!="undefined"?e.textname:e.anim;u[f]={text:r,colors:i,anim:e.anim},typeof i[s].fill!="undefined"&&(n.fill=i[s].fill),typeof i[s].stroke!="undefined"&&(n.stroke=i[s].stroke)}r.style=n,typeof e.opacity!="undefined"&&(r.alpha=e.opacity);if(typeof e.blur!="undefined"){var l=new PIXI.filters.BlurFilter;l.blur=e.blur,r.filters?(filters=r.filters,filters.push(l),r.filters=filters):r.filters=[l]}return r}function m(){c("jpPlayout"),f&&requestAnimationFrame(m)}var t=this,n=[],r,i={},s={},o={},u={},a=!1,f=!1;(function(e){typeof e.animManager!="undefined"&&(r=e.animManager),PIXI.AUTO_PREVENT_DEFAULT=!1})(e),this.load=function(e){if(typeof e.name=="undefined")return;var t=typeof e.divID!="undefined"?e.divID:e.name+"_spine_container",n=$("#"+t),r=PIXI.autoDetectRenderer(n.width(),n.height(),{transparent:!0});r.plugins.interaction.autoPreventDefault=!1,n.append(r.view),stage=new PIXI.Container,i[e.name]={renderer:r,stage:stage},typeof e.scale!="undefined"&&stage.scale.set(e.scale,e.scale),e.isSpineAnim?PIXI.loader.add(e.name,jv_pixiResources+e.name+".json").load(function(t,n){l(e,t,n)}):typeof e.callback=="function"&&e.callback()},this.show=function(e,t){if(typeof i[e]=="undefined")return;i[e].spine.skeleton.setToSetupPose(),i[e].spine.update(0),i[e].stage.addChild(i[e].spine),i[e].spine.state.setAnimationByName(0,t,!1),i[e].autoUpdate=!1,c(e)},this.start=function(e,s){if(typeof i[e]=="undefined")return;var o=i[e].spine.state.getCurrent(0);(!o||o!==s)&&t.show(e,s),i[e].spine.autoUpdate=!0;var u=!1;for(var a in n)a==e&&(u=!0);u||n.push(e),r.add("pixiManagerAnimate",h)},this.pause=function(e){if(typeof i[e]=="undefined")return;i[e].spine.autoUpdate=!1},this.stop=function(e,t){if(typeof i[e]=="undefined")return;var r=[];for(var s in n)n[s]!==e&&r.push(s);n=r,(typeof t=="undefined"||!t)&&i[e].stage.removeChildren()},this.clear=function(e){t.stop(e),c(e)},this.storeImages=function(e){for(var t in e)s[t]=PIXI.Texture.fromImage(e[t])},this.storeSymbolAnim=function(e,t,n){var r=function(e,t,n,r){e.animationSpeed=n.speed,e.loop=typeof n.loop!="undefined"?n.loop:!0,n.scale&&e.scale.set(n.scale),n.center?e.anchor.set(n.center.x,n.center.y):e.anchor.set(.5,.5);var i=typeof n.onEnd=="function"?n.onEnd:function(){};e.onComplete=function(){f=!1,e.visible=!1,i()},typeof o[n.type]=="undefined"&&(o[n.type]=[]),o[n.type].push({levels:n.levels,anim:e}),typeof r=="function"&&r()},i=null;typeof t.spritesheets!="undefined"?PIXI.loader.add(t.spritesheets).load(function(s,o){var u=[],a=typeof t.framePrefix!="undefined"?t.framePrefix:e;for(var f=t.minFrame;f<=t.maxFrame;f++)u.push(a+f);i=new PIXI.extras.AnimatedSprite.fromFrames(u),r(i,e,t,n)}):typeof t.pics!="undefined"&&(i=new PIXI.extras.AnimatedSprite.fromImages(t.pics),r(i,e,t,n))},this.addTextToAnim=function(e,t){if(typeof e.anim=="undefined"||typeof i[e.anim]=="undefined")return;if(typeof e.text=="undefined"&&e.textblocks==="undefined")return;var n=v(e);if(typeof e.maxWidth!="undefined"&&n.width>e.maxWidth){var r=e.maxWidth/n.width;n.scale.set(r,r);var s=n.style;typeof s.lineheight!="undefined"&&(s.lineHeight=.9*s.lineHeight/r,n.style=s)}var o=i[e.anim].stage.scale,u=typeof e.left!="undefined"?e.left:(i[e.anim].renderer.width-o.x*n.width)/2;u/=o.x,typeof e.extraOffsetLeft!="undefined"&&(u+=e.extraOffsetLeft);var a=typeof e.top!="undefined"?e.top:(i[e.anim].renderer.height-o.y*n.height)/2;typeof e.extraOffsetTop!="undefined"&&(a+=e.extraOffsetTop),a<0&&(a/=o.y),n.position.set(u,a),typeof e.resolution!="undefined"&&(n.resolution=e.resolution),typeof e.static!="undefined"&&e.static&&(n.cacheAsBitmap=!0),i[e.anim].stage.addChild(n),c(e.anim),typeof t=="function"&&t()},t.changeTextColor=function(e,t){if(typeof u[e]=="undefined")return;if(typeof u[e].colors[t]=="undefined")return;var r=u[e].text.style,i=u[e].colors[t];r.fill=typeof i=="object"?i.fill:i,r.stroke=typeof i=="object"?i.stroke:i,u[e].text.style=r;if(typeof u[e].anim!="undefined"){var s=!1;for(var o in n)o==u[e].anim&&(s=!0);s||c(u[e].anim)}},this.loadJackpotPlayoutScreen=function(e,r,o){if(a)return;a={};var f=i[e.general.environment].stage;if(typeof s[e.general.bgMetal.normal]=="undefined")return jv_debug&&console.error("texture for metals background picture has not been stored before trying to load the jackpot playout screen in pixiManager"),!1;a.metalTextures={normal:s[e.general.bgMetal.normal],active:s[e.general.bgMetal.active]},a.winValueTextures={normal:s[e.general.winValues.bg.normal],active:s[e.general.winValues.bg.active]},a.winValueBGs={},a.metalBGs={};for(var l in e.winLevels){var h=null;typeof e.winLevels[l].bgMetal!="undefined"?h=new PIXI.Sprite(s[e.winLevels[l].bgMetal.normal]):h=new PIXI.Sprite(s[e.general.bgMetal.normal]);var p=e.general.textLeft.metal;typeof e.winLevels[l].bgMetalOffsetX!="undefined"?p+=e.winLevels[l].bgMetalOffsetX:typeof e.general.bgMetalOffsetX!="undefined"&&(p+=e.general.bgMetalOffsetX);var v=e.winLevels[l].top;typeof e.winLevels[l].bgMetalOffsetY!="undefined"?v+=e.winLevels[l].bgMetalOffsetY:typeof e.general.bgMetalOffsetY!="undefined"&&(v+=e.general.bgMetalOffsetY),h.anchor.set(.5,.5),h.position.set(p,v),f.addChild(h),a.metalBGs[l]=h;if(typeof s[e.general.bgMetal.normal+"-"+l]!="undefined"){var m=new PIXI.Sprite(s[e.general.bgMetal.normal+"-"+l]);m.anchor.set(.5,.5),h.addChild(m);if(typeof s[e.general.bgMetal.normal+"-"+l+"-inactive"]!="undefined"){var g=new PIXI.Sprite(s[e.general.bgMetal.normal+"-"+l+"-inactive"]);g.anchor.set(.5,.5),h.addChild(g)}}var y=new PIXI.Sprite(a.winValueTextures.normal);y.anchor.set(1,.5),y.position.set(e.general.textLeft.winValue,e.winLevels[l].top),f.addChild(y),a.winValueBGs[l]=y}var b=new PIXI.Container;f.addChild(b),a.sweep={container:b};var w={fontWeight:e.general.fontWeight,fontSize:e.general.fontSize,fontFamily:e.general.fontFamily,fill:e.general.metalShadow.offsetX,"static":!0},E=new PIXI.filters.BlurFilter;E.blur=e.general.metalShadow.blur;var S={fontWeight:e.general.fontWeight,fontSize:e.general.fontSize,fontFamily:e.general.fontFamily,strokeThickness:e.general.strokeThickness};r||(S.resolution=1.75);var x={fontWeight:e.general.fontWeight,fontSize:e.general.fontSize,fontFamily:e.general.fontFamily,fill:e.general.winValues.colors.normal,align:"right","static":!0};a.metalTextnames={};for(var l in e.winLevels){var T=new PIXI.Text(e.winLevels[l].metalText,w);T.position.set(e.general.textLeft.metal+e.general.metalShadow.offsetX,e.winLevels[l].top+e.general.metalShadow.offsetY),T.anchor.set(.5,.49),T.filters=[E],f.addChild(T);var N=new PIXI.Text(e.winLevels[l].metalText,S);f.addChild(N),N.anchor.set(.5,.49),N.position.set(e.general.textLeft.metal,e.winLevels[l].top);var C=e.winLevels[l].metalColors,k={};for(var L in C){k[L]={};for(var A in C[L])C[L][A][0]!="#"?k[L][A]=d(C[L][A],N):k[L][A]=C[L][A]}u[e.winLevels[l].metalTextname]={text:N,colors:k,top:e.winLevels[l].top},a.metalTextnames[l]=e.winLevels[l].metalTextname,t.changeTextColor(e.winLevels[l].metalTextname,"normal"),N=new PIXI.Text(displayMoney(e.winLevels[l].winValue,!1,0,!0),x),f.addChild(N),N.anchor.set(1,.49),N.position.set(e.general.textLeft.winValue-e.general.winValues.paddingRight,e.winLevels[l].top),u[e.winLevels[l].winValueTextname]={text:N,colors:e.general.winValues.colors}}a.inactiveOverlays={};for(var l in e.winLevels)if(typeof e.winLevels[l].inactiveOverlay!="undefined"){var O=new PIXI.Sprite(s[e.winLevels[l].inactiveOverlay]),M=e.general.textLeft.metal;typeof e.winLevels[l].bgMetalOffsetX!="undefined"?M+=e.winLevels[l].bgMetalOffsetX:typeof e.general.bgMetalOffsetX!="undefined"&&(M+=e.general.bgMetalOffsetX);var _=e.winLevels[l].top;typeof e.winLevels[l].bgMetalOffsetY!="undefined"?_+=e.winLevels[l].bgMetalOffsetY:typeof e.general.bgMetalOffsetY!="undefined"&&(_+=e.general.bgMetalOffsetY),O.position.set(M,_),O.anchor.set(.5,.5),O.visible=!1,f.addChild(O),a.inactiveOverlays[l]=O}var D=new PIXI.Container;f.addChild(D),a.win={container:D},c(e.general.environment);var P=!1;for(var H in n)H==e.general.environment&&(P=!0);P||n.push(e.general.environment),typeof o=="function"&&o()},this.addJackpotPlayoutAnims=function(e,t){for(var n in o)for(var r in o[n]){var i=o[n][r].anim;i.position.set(e.general.textLeft.metal,e.winLevels[0].top),i.visible=!1;var s=a[n].container;s.addChild(i);var u=s.getChildIndex(i);typeof a[n].animPerLevel=="undefined"&&(a[n].animPerLevel={});for(var f in o[n][r].levels)a[n].animPerLevel[o[n][r].levels[f]]=u}typeof t=="function"&&t()},this.resetJackpotPlayoutValues=function(e,r){if(e)for(var i in e)u[e[i].textname].text.text=displayMoney(e[i].textcontent,!1,0,!0),a.metalBGs[i].texture=a.metalTextures.normal,a.winValueBGs[i].texture=a.winValueTextures.normal,typeof a.inactiveOverlays[i]!="undefined"&&(a.inactiveOverlays[i].visible=e[i].inactive),a.metalBGs[i].children.length==2&&(a.metalBGs[i].getChildAt(1).visible=e[i].inactive),typeof u[e[i].metalTextname].colors.inactive!="undefined"&&t.changeTextColor(e[i].metalTextname,e[i].inactive?"inactive":"normal"),typeof u[e[i].textname].colors.inactive!="undefined"&&t.changeTextColor(e[i].textname,e[i].inactive?"inactive":"normal");for(var s in a)if(s==="sweep"||s==="win")for(var o in a[s].container.children)a[s].container.children[o].stop(),a[s].container.children[o].visible=!1;var f=!1;for(var l in n)l=="jpPlayout"&&(f=!0);f||n.push("jpPlayout"),m(),typeof r=="function"&&r()},this.changeJackpotPlayoutSituation=function(e){if(!a)return;if(typeof e.actWinValue!="undefined")for(var n in e.actWinValue)typeof a.winValueBGs[n]!="undefined"&&(a.metalBGs[n].texture=a.metalTextures[e.actWinValue[n]?"active":"normal"],a.winValueBGs[n].texture=a.winValueTextures[e.actWinValue[n]?"active":"normal"]);if(typeof e.actMetal!="undefined")for(var n in e.actMetal)typeof a.metalTextnames[n]!="undefined"&&t.changeTextColor(a.metalTextnames[n],e.actMetal[n]?"shine":"normal");var r={sweep:!0,win:!0};for(var i in r)if(typeof e[i]!="undefined"&&typeof a[i].animPerLevel[e[i]]!="undefined"&&typeof a.metalBGs[e[i]]){var s=a[i].animPerLevel[e[i]],o=a[i].container.getChildAt(s);o.position.set(a.metalBGs[e[i]].position.x,a.metalBGs[e[i]].position.y),o.visible=!0,o.gotoAndPlay(0),f=!0}if(typeof e.stopAnims!="undefined"&&e.stopAnims){for(var i in r)for(var u in a[i].container.children)a[i].container.children[u].stop(),a[i].container.children[u].visible=!1;t.stop("jpPlayout",!0),f=!1}else requestAnimationFrame(m)}};