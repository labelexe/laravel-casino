/**
 * class for managing freegames
 * @copyright LoCoNET GmbH 2013-2014
 */function FreeGame(e){function _(e,t,n){n.timelineName==="Symbol Selection"&&setTimeout(function(){s.addListener({type:s.onSceneLoad,callback:D}),s.show("reset",L),s.clearListeners(s.onTimelineComplete,_)},1e3)}function D(e,t,n){e.documentName()==L&&(s.clearListeners(s.onSceneLoad,D),s.addListener({type:s.onSceneLoad,callback:P}),s.show("start",L))}function P(e,t,n){e.documentName()==L&&(s.clearListeners(s.onSceneLoad,P),A())}function H(e,n){typeof n=="undefined"&&(n=!1);var s=function(){$("._wlid_darkening").css("opacity",0),$("#pixi_container").css("opacity",1).show(),$(".freegame_blending").addClass("pixi").show(),$(".gameContainer").addClass("fgSignVisible"),C&&C.addClass("plain"),k&&k.addClass("plain"),$(".mainControlBoxBG").addClass("plain");var t=r.mode("r")==0?2:1,s=[];for(var o in obj_lang.game_freegame_intro){var a=obj_lang.game_freegame_intro[o];s[o]=a.replace("<<countFG>>",e.winFG)}var f={anim:"GenericSign",textblocks:s,fontfamily:M,fontweight:"bold",fontsize:t*73,maxWidth:t*480,top:t*60,fill:"#000000",opacity:.55,blur:2,extraOffsetLeft:t*2.25,extraOffsetTop:t*3.9},l={anim:"GenericSign",textblocks:s,fontfamily:M,fontweight:"bold",fontsize:t*73,maxWidth:t*480,top:t*60,fill:"90-#ffe57d:19-#ff9c00:46-#ffe57d:46-#ff9c00:81",stroke:"#ffe57d",strokeThickness:2*t};u.addTextToAnim(f),u.addTextToAnim(l),i.play({playwhat:"fanfare"}),e.changeSymbols(),e.onFreegameIntroPause(function(t){u.stop("GenericSign"),$("#freegame_container").addClass("pixi").show({complete:function(){$("#pixi_container").css("opacity",0);var n=function(){C&&C.removeClass("plain"),k&&k.removeClass("plain"),$(".mainControlBoxBG").removeClass("plain"),$(".gameContainer").removeClass("fgSignVisible"),$(".freegame_blending").hide().removeClass("pixi"),$("#freegame_container").hide().removeClass("pixi"),e.startFreegame()};typeof E=="function"?(typeof t!="undefined"&&(e.bonusSymbol=t),E(e,n)):n()}})}),n&&b&&b()};if(n)s();else if(r.playSymbolAnims()){var o=e.animHandler,a=typeof e.scatterPositions!="undefined"?e.scatterPositions:t.getScatterPositions();obj_anim.setFixedSymbols([13]),$("._wlid_darkening").css("opacity",1),i.play({playwhat:"fgTrigger"}),o.play(h,a,{loop:!1,onEnd:s,endDelay:typeof e.afterBonusAnimDelay!="undefined"&&e.afterBonusAnimDelay?e.afterBonusAnimDelay:1100},null,!0)}else if(S){var o=e.animHandler,a=typeof e.scatterPositions!="undefined"?e.scatterPositions:t.getScatterPositions();$("._wlid_darkening").css("opacity",1),o.playOpt(h,a,!0),i.play({playwhat:g,callback:function(){o.stopOpt(),s()}})}else setTimeout(s,600)}function B(e){var n=function(){$("#pixi_container").css({"background-image":"none",opacity:1});var t=function(){u.stop("GenericSign"),$("._wlid_darkening").css("opacity",0),$("#pixi_container").css({"background-image":"",opacity:0}),e.continueFreegame()},n=r.mode("r")==0?2:1,s={anim:"GenericSign",fontfamily:M,fontweight:"bold",fontsize:n*58,maxWidth:n*435,fill:"#000000",opacity:.55,blur:2,extraOffsetLeft:n*2.25,extraOffsetTop:n*3.9},o={anim:"GenericSign",fontfamily:M,fontweight:"bold",fontsize:n*58,maxWidth:n*435,fill:"90-#ffe57d:19-#ff9c00:46-#ffe57d:46-#ff9c00:81",stroke:"#ffe57d",strokeThickness:2*n},a=obj_lang.game_freegame_retrigger;for(var f in a)s.text=a[f].replace("<<countFG>>",e.winFG),s.top=n*(51+f*59),u.addTextToAnim(s),o.text=a[f].replace("<<countFG>>",e.winFG),o.top=n*(51+f*59),u.addTextToAnim(o);i.play({playwhat:"fanfare",callback:t}),e.onAbortable(t)};i.muteBgSound(!0);if(r.playSymbolAnims()){var s=t.getScatterPositions();obj_anim.setFixedSymbols([13]),$("._wlid_darkening").css("opacity",1),i.play({playwhat:"fgTrigger"}),e.playAnim(p,s,{loop:!1,onEnd:n,endDelay:900})}else if(S){var o=e.animHandler,s=t.getScatterPositions();o.stopOpt(),$("._wlid_darkening").css("opacity",1),o.playOpt(p,s),i.play({playwhat:"fgTrigger",callback:function(){o.stopOpt(),n()}})}else setTimeout(function(){$("._wlid_darkening").css("opacity",1),n()},600)}function j(e){var t=parseFloat(e.win)<.001,n=t&&v,s=function(){i.getActiveSound("fg2")==="fgEnd"&&i.stop("fg2"),$("#stickySymbolContainer").remove(),u.stop("GenericSign"),e.changeSymbols(),$("#pixi_container").hide(),$(".freegame_blending").hide().removeClass("pixi"),$(".gameContainer").removeClass("fgSignVisible"),$(".headlineContainer").removeClass("plain pixi"),C&&C.removeClass("plain"),k&&k.removeClass("plain"),e.onFinished()};$("#pixi_container").hide().css("opacity",1).fadeIn("normal"),$(".freegame_blending").hide().addClass("pixi").fadeIn("normal"),$(".gameContainer").addClass("fgSignVisible");var o=$(".headlineContainer .fgBonusSymbol, .headlineContainer .fgPayTable");o.fadeOut("normal",function(){$(".headlineContainer").removeClass("fourLine"),o.remove()}),C&&C.addClass("plain"),k&&k.addClass("plain"),e.onStart(s);var a=r.mode("r")==0?2:1,f={anim:"GenericSign",fontfamily:M,fontweight:"bold",fontsize:a*54,maxWidth:a*480,fill:"#000000",opacity:.55,blur:2,extraOffsetLeft:a*2.25,extraOffsetTop:a*3.9},l={anim:"GenericSign",fontfamily:M,fontweight:"bold",fontsize:a*54,maxWidth:a*480,fill:"90-#ffe57d:19-#ff9c00:46-#ffe57d:46-#ff9c00:81",stroke:"#ffe57d",strokeThickness:2*a};if(n){var c=obj_lang["game_freegame_outro-noWin"];f.textblocks=c,f.top=a*73,u.addTextToAnim(f),l.textblocks=c,l.top=a*73,u.addTextToAnim(l)}else{var h=obj_lang.game_freegame_outro[0];f.text=h,f.top=a*73,u.addTextToAnim(f),l.text=h,l.top=a*73,u.addTextToAnim(l),h=displayMoney(e.win,!1,0,!0),f.fontsize=parseInt(1.2*f.fontsize),f.text=h,f.top=a*139,u.addTextToAnim(f),l.fontsize=parseInt(1.2*l.fontsize),l.text=h,l.top=a*139,u.addTextToAnim(l)}i.play({playwhat:"fgEnd",callback:s})}var t=this,n=null,r=null,i=null,s=null,o=null,u=null,a=3,f=5,l=null,c=11,h=!1,p=!1,d=!1,v=!1,m=!1,g="fgTrigger",y=null,b=null,w=!0,E=null,S=!1,x=!1,T=!1,N=null,C=null,k=null,L=!1,A=null,O=e.lang,M=O=="vi"?"Arial":" Roboto Condensed, Arial";(function(e){n=e.conf,r=e.devConf,i=e.sound,typeof e.hype!="undefined"&&(s=e.hype),o=e.animManager,typeof e.pixiManager!="undefined"&&(u=e.pixiManager),l=e.getReelIdx,a=e.conf.rows(),f=e.conf.reels(),typeof e.scatter!="undefined"&&(c=e.scatter),typeof e.animBG!="undefined"&&(h=e.animBG),typeof e.animFG!="undefined"&&(p=e.animFG),typeof e.hasNoWinOutro!="undefined"&&(v=e.hasNoWinOutro),typeof e.showWonFreegames!="undefined"&&(d=e.showWonFreegames),typeof e.renderFreegameSign=="function"&&(y=e.renderFreegameSign),typeof e.spinAfterIntro=="function"&&(b=e.spinAfterIntro),typeof e.startPauseCallback=="function"&&(E=e.startPauseCallback),typeof e.useOptimalAnim!="undefined"&&(S=e.useOptimalAnim),typeof e.extraSignBackground!="undefined"&&(x=e.extraSignBackground),typeof e.fgTriggerSound!="undefined"&&(g=e.fgTriggerSound),w=r.playSymbolAnims(),N=$("#freegame_container"),C=$(".headlineContainer"),C.size()||(C=!1),typeof e.plainForPortrait!="undefined"&&e.plainForPortrait&&(k=$(".portraitHeadlineContainer"));if(k===null||!k.size())k=!1})(e),this.getScatterPositions=function(){var e=[];if(!m)return;if($.isArray(m[0]))for(var t=0;t<f;++t){var r=m[t];if(!r||!r.length)continue;for(var i in r){var s=r[i];e.push({x:n.size("sWs")*t,y:n.size("sH")*s,elem:$("#reel_"+l(t)+"_"+(a-s))})}}else for(var t=0;t<f;++t){if(m[t]===!1)continue;e.push({x:n.size("sWs")*t,y:n.size("sH")*m[t],elem:$("#reel_"+l(t)+"_"+(a-m[t]))})}return e},this.setFreeGameTriggers=function(e){m=e},this.start=function(e,n){if(u){H(e,n);return}typeof n=="undefined"&&(n=!1);var r=function(){d&&(N.html('<div id="winFGLayer" class="fgSignBox"></div>'),$("#winFGLayer").html(e.winFG));var t=function(){$("._wlid_darkening").css("opacity",0),C&&C.addClass("plain"),k&&k.addClass("plain"),x&&$(".mainControlBoxBG").addClass("plain"),N.addClass("intro").show(),i.play({playwhat:"fanfare"}),e.changeSymbols();var t=function(){C&&C.removeClass("plain"),k&&k.removeClass("plain"),x&&$(".mainControlBoxBG").removeClass("plain"),e.startFreegame(),N.hide().removeClass("intro").html("")},r=E?function(n){typeof n!="undefined"&&(e.bonusSymbol=n),E(e,t)}:t;e.onFreegameIntroPause(r),n&&b&&b()};typeof y=="function"?y("intro",t):t()};if(n)r();else if(w){var s=e.animHandler,o=t.getScatterPositions();obj_anim.setFixedSymbols([c]);var a=0,f=function(){++a>=2&&r()};$("._wlid_darkening").css("opacity",1),i.play({playwhat:g,callback:f}),s.play(h,o,{loop:!1,onEnd:f,endDelay:typeof e.afterAnimDelay!="undefined"?e.afterAnimDelay:1100},null,!0)}else if(S){var s=e.animHandler,o=t.getScatterPositions();$("._wlid_darkening").css("opacity",1),s.playOpt(h,o,!0),i.play({playwhat:g,callback:function(){s.stopOpt(),r()}})}else setTimeout(r,600)},this.retrigger=function(e){if(u){B(e);return}var n=function(){T=!1,N.hide().removeClass("retrigger").html(""),$("._wlid_darkening").css("opacity",0),e.continueFreegame()},r=function(){d&&(N.html('<div id="winRetriggerLayer" class="fgSignBox"></div>'),$("#winRetriggerLayer").html(e.winFG)),N.hide();var t=function(){N.addClass("retrigger").show(),T=!0;var t=Date.now()+3e3,r=!1,s=function(){return T?(r&&Date.now()>=t&&n(),!0):!1};o.add("finishRetriggerTimeout",s),i.play({playwhat:"fanfare",callback:function(){r=!0}}),e.onAbortable(n)};typeof y=="function"?y("retrigger",t):t()};i.muteBgSound(!0);if(w){var s=t.getScatterPositions();obj_anim.setFixedSymbols([c]),$("._wlid_darkening").css("opacity",1),i.play({playwhat:"fgTrigger"}),e.playAnim(p,s,{loop:!1,onEnd:r,endDelay:900})}else if(S){var a=e.animHandler,s=t.getScatterPositions();a.stopOpt(),$("._wlid_darkening").css("opacity",1),a.playOpt(p,s),i.play({playwhat:"fgTrigger",callback:function(){a.stopOpt(),r()}})}else setTimeout(function(){$("._wlid_darkening").css("opacity",1),r()},600)},this.stop=function(e){if(u){j(e);return}var t=parseFloat(e.win)<.001,n=displayMoney(e.win);N.hide(),(!t||!v)&&N.html('<div id="freegamePoints">'+n+"</div>");var r=function(){i.getActiveSound("fg2")==="fgEnd"&&i.stop("fg2"),$("#stickySymbolContainer").remove(),e.changeSymbols(),N.hide().html("").removeClass("outro").removeClass("nowin"),x?(C&&C.find(".freegame_blending").hide().removeClass("plain"),k&&k.find(".freegame_blending").hide().removeClass("plain"),$(".mainControlBox .freegame_blending").hide().removeClass("plain")):(C&&C.removeClass("plain"),k&&k.removeClass("plain")),e.onFinished()},s=function(){t&&v&&N.addClass("nowin"),x?(C&&C.find(".freegame_blending").hide().addClass("plain").fadeIn("normal"),k&&k.find(".freegame_blending").hide().addClass("plain").fadeIn("normal"),$(".mainControlBox .freegame_blending").hide().addClass("plain").fadeIn("normal")):(C&&C.addClass("plain"),k&&k.addClass("plain")),N.addClass("outro").fadeIn("normal"),e.onStart(r),i.play({playwhat:"fgEnd",callback:r})};typeof y=="function"?y(t?"outro_noWin":"outro",s):s()},this.addStartHypeListener=function(e,t){if(!s){console.error("no hype object defined!");return}L=e,A=t,s.addListener({type:s.onTimelineComplete,callback:_})}};