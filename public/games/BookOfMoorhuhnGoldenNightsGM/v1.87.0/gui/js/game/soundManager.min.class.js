/**
 * class for loading and managing sounds (one background sound and multiple forground sounds)
 * @copyright LoCoNET GmbH 2013-2014
 */function SoundManager(params){function onLoadedHowler(){++soundsLoaded,soundsLoaded>=soundsToLoad?onLoaded?onLoaded():onProgress&&onProgress(soundsLoaded):onProgress&&onProgress(soundsLoaded)}function loadVisibilityChange(){var e=!1,t=!1,n={hidden:"visibilitychange",mozHidden:"mozvisibilitychange",msHidden:"msvisibilitychange",webkitHidden:"webkitvisibilitychange"};for(var t in n)if(typeof document[t]!="undefined"){e=n[t];break}e&&document.addEventListener(e,function(){onVisibilityChange(!document[t])},!1)}function onVisibilityChange(e){e?soundOffWhileHidden&&(soundOffWhileHidden=!1,soundOn||thiz.soundOn()):soundOn&&(soundOffWhileHidden=!0,thiz.soundOff())}function onEndBGSound(e){e==bgIsPlaying&&(bgIsPlayingOnLoop||(bgIsPlaying=!1),typeof bgCallback=="function"&&bgCallback(),bgIsPlayingOnLoop||(bgCallback=!1))}function onEndFGSound(e,t){if(t==fgIsPlaying[e]){var n=fgIsPlayingOnLoop[e];n||(fgIsPlaying[e]=!1);if(typeof fgCallbacks[e]=="function"){var r=fgCallbacks[e];n||(fgCallbacks[e]=!1),r()}}}var thiz=this,volume=1,bgSound=null,sounds={},fgCallbacks={},fgIsPlaying={},fgIsPlayingOnLoop={},fgFadeout={},defaultFgSound="fg",bgIsMuted=!1,bgIsExplicMuted=!1,bgCallback=!1,bgIsPlaying=!1,bgIsPlayingOnLoop=!1,bgFadeout=!1,soundOn=!1,soundOffWhileHidden=!1,soundsToLoad=0,soundsLoaded=0,onLoaded=null,onProgress=null,map={},resumed=!1;(function(e){__initHowler(),typeof e.onLoaded=="function"&&(onLoaded=e.onLoaded),typeof e.onProgress=="function"&&(onProgress=e.onProgress);var t=typeof e.version=="undefined"?"":e.version,n=e.soundVersions,r=e.plusSound;for(key in e.soundfiles)++soundsToLoad;for(key in e.soundfiles){var i=e.soundfiles[key].type;map[i]=e.soundfiles[key].map;var s={};for(var o in e.soundfiles[key].map)s[o]=new Array(e.soundfiles[key].map[o].start*1e3,e.soundfiles[key].map[o].dur,!1);var u=function(e){return function(t){onEndFGSound(e,t)}}(i),a=[];for(var f in n){var l=n[f];r&&key=="fgB"&&l.indexOf("SMono")==0&&(l="P"+l.substr(1)),a.push(jv_soundURL+key+t+l)}var c=new Howl({urls:a,autoplay:!1,loop:!1,sprite:s,onload:onLoadedHowler,onloaderror:onLoadedHowler,onend:i=="bg"?onEndBGSound:u});if(i=="bg")bgSound=c;else{var h=i;sounds[h]=c,fgCallbacks[h]=!1,fgIsPlaying[h]=!1,fgIsPlayingOnLoop[h]=!1,fgFadeout[h]=!1}}soundOn=e.soundOn,loadVisibilityChange()})(params),this.playBgSound=function(e,t,n){bgIsPlaying&&(bgSound.stop(bgIsPlaying),bgIsPlaying=!1),typeof n=="undefined"&&(n=!1),bgIsPlayingOnLoop=n,bgIsPlaying=e,bgCallback=typeof t=="function"?t:null,bgSound.loop(n).volume(bgIsMuted?0:volume).play(e,bgIsPlaying)},this.stopBgSound=function(){bgIsPlaying&&(bgCallback=!1,bgSound.stop(bgIsPlaying),bgIsPlaying=bgIsPlayingOnLoop=!1,bgFadeout&&(clearTimeout(bgFadeout),bgFadeout=!1))},this.fadeToStopBgSound=function(e){bgIsPlaying&&(bgCallback=!1,bgSound.fade(volume,0,e,null,bgIsPlaying),bgFadeout&&clearTimeout(bgFadeout),bgFadeout=setTimeout(function(){bgSound.stop(bgIsPlaying),bgIsPlaying=bgIsPlayingOnLoop=!1,bgFadeout=!1},e))},this.fadeToStopFgSound=function(e,t){typeof t=="undefined"&&(t=defaultFgSound),fgIsPlaying[t]&&(fgCallbacks[t]&&(typeof fgCallbacks[t]=="number"&&clearTimeout(fgCallbacks[t]),fgCallbacks[t]=!1),sounds[t].fade(volume,0,e,null,fgIsPlaying[t]),fgFadeout[t]&&clearTimeout(fgFadeout[t]),fgFadeout[t]=setTimeout(function(){sounds[t].stop(fgIsPlaying[t]),fgIsPlaying[t]=fgIsPlayingOnLoop[t]=!1,fgFadeout[t]=!1},e))},this.muteBgSound=function(e){if(bgIsMuted&&bgIsExplicMuted)return;typeof e!="undefined"&&e?bgSound.fade(volume,0,typeof e=="number"?e:100,null,bgIsPlaying):(bgSound.mute(),bgIsExplicMuted=!0),bgIsMuted=!0},this.setBgSoundVolume=function(e){bgSound.volume(e*volume)},this.unmuteBgSound=function(e){bgIsMuted&&(!bgIsExplicMuted&&typeof e!="undefined"&&e?bgSound.fade(0,volume,typeof fadeout=="number"?fadeout:300,null,bgIsPlaying):(bgIsExplicMuted=!1,soundOn&&bgSound.unmute(),bgSound.volume(volume)),bgIsMuted=!1)},this.isBgMuted=function(){return bgIsMuted},this.play=function(params){var playwhat=params.playwhat,soundLine=typeof params.soundLine!="undefined"&&params.soundLine?params.soundLine:defaultFgSound,callback=typeof params.callback=="function"?params.callback:null,callbackTime=typeof params.callbackTime!="undefined"?params.callbackTime:0,loop=typeof params.loop=="undefined"?!1:params.loop;resumed||(sounds[soundLine].resume(),resumed=!0),fgCallbacks[soundLine]&&(typeof fgCallbacks[soundLine]=="number"&&clearTimeout(fgCallbacks[soundLine]),fgCallbacks[soundLine]=!1),fgIsPlaying[soundLine]&&(sounds[soundLine].stop(fgIsPlaying[soundLine]),fgIsPlaying[soundLine]=fgIsPlayingOnLoop[soundLine]=!1),fgIsPlayingOnLoop[soundLine]=loop,fgIsPlaying[soundLine]=playwhat,sounds[soundLine].loop(loop).volume(volume).play(playwhat,fgIsPlaying[soundLine]),callback&&(callbackTime?fgCallbacks[soundLine]=function(callback){return setTimeout(function(){fgCallbacks[soundLine]=!1,callback()},typeof callbackTime=="string"?eval(map[soundLine][playwhat].dur+callbackTime):callbackTime)}(callback):fgCallbacks[soundLine]=callback)},this.playGeneric=function(e,t){typeof t=="undefined"&&(t=!1);if(t&&!fgIsPlaying[t])thiz.play({soundLine:t,playwhat:e});else for(var n in fgIsPlaying)if(!fgIsPlaying[n]){thiz.play({soundLine:n,playwhat:e});break}},this.stop=function(e){typeof e=="undefined"&&(e=!1);for(var t in fgIsPlaying){if(e&&t!=e)continue;fgCallbacks[t]&&(typeof fgCallbacks[t]=="number"&&clearTimeout(fgCallbacks[t]),fgCallbacks[t]=!1),fgIsPlaying[t]&&(sounds[t].stop(fgIsPlaying[t]),fgIsPlaying[t]=!1),fgIsPlayingOnLoop[e]=!1}},this.soundOff=function(){soundOn=!1,Howler.mute()},this.soundOn=function(){soundOn||Howler.unmute(),soundOn=!0},this.getActiveBGSound=function(){return bgIsPlaying},this.getActiveSound=function(e){return typeof e=="undefined"&&(e=defaultFgSound),fgIsPlaying[e]},this.setDefaultSoundLine=function(e){defaultFgSound=e}};