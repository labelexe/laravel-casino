/**
 * class for managening the win animations
 * @copyright LoCoNET GmbH 2014-05-30
 */function WinAnimator(e){function Pt(){p=!1;if(mt){l&&(un(),q&&q()),Rt(!0);var e=mt;mt=null,e(Pt);return}var t=!1;return Y&&(t=Y),Y=Z=null,f&&(it&&(!yt||st>=6||typeof ht=="string")?restartFreegameBGSound():bt&&(restartBasegameBGSound(),bt=!1)),t&&t(),f=!1,!1}function Ht(){p="bell",Z&&Z();if(Ct==2||Ct==1){var e=ut!==!1?ut:ot;if(e>=100){var t=1;e>=500?t=3:e>=200&&(t=2),++ft,n.play({playwhat:"cbellLong",callback:ft<t?Ht:Bt})}else e>=40?n.play({playwhat:Ct==2?"cbellMedium":"cbellShort",callback:Bt}):e>=20&&Ct==2?n.play({playwhat:"cbellShort",callback:Bt}):Bt()}else Bt()}function Bt(){p="five",ct&&n.getActiveBGSound()&&!n.isBgMuted()&&(bt=!0,it?n.muteBgSound():yt&&n.muteBgSound(!0)),ct&&o.useCoinShowers()?(n.play({playwhat:"5ofAKind",callback:function(){lt=!1,jt()}}),r.start("tl_5ofakind",h),lt=!0):jt()}function jt(){p="blockAnim";if(N&&T){var e=N.substring(N.length-1);o.useSmallSounds()||n.play({playwhat:"block"+e});var t=function(){L=!1,r.addListener({type:r.onTimelineComplete,callback:en}),r.start(T[N],T.hype),$("._wlid_darkening").css("opacity",1)};C?(L=!0,C(t)):t()}else Ut()}function Ft(){if(V==0)return!1;var e=Date.now();if(K){var t=[];for(var n in X)t.push(n);var r=K(e-J,t);if(typeof r=="object")for(var n in r)X[n].css({opacity:r[n]});else for(var n in X)X[n].css({opacity:r})}else{var r=0,i=(e-J)%1e3,s=300,o=700;i<s?r=i/s:i>o?r=(1e3-i)/s:r=1;for(var n in X)X[n].css({opacity:r})}return!0}function It(e){if(!W)for(var t in e)U[t]&&U[t].prepare(e[t])}function qt(e){var n=Date.now();for(var r in e)W&&z[r]?t.playOptimalAnimation(r,e[r]):r.substr(0,1)=="$"?(r=r.substr(1),U[r]&&U[r].start({dontLoopMode3:!0,now:n})):U[r]&&U[r].start({now:n})}function Rt(e){_t&&_t();if(W)$(".symbolAnimLayer").remove(),X={},V=0;else{c=!1;if(vt){for(var t in vt)U[t]&&U[t].stop();vt=null}if(y&&e){for(var t in y)U[t]&&U[t].stop();y=null}}}function Ut(){p="x25";var e=A&&H?zt:Jt,r=o.playSymbolAnims();wt&&wt(),ot>=25&&o.noSymbolAnimDuringHype()&&!W&&!ht||(qt(vt),dt&&r&&t.playExtraAnimations(dt)),ht&&(r||pt)?o.useSmallSounds()==="optimal"&&!pt?n.play({playwhat:"win25",callback:e}):n.play({playwhat:typeof ht!="string"?"topWinx25":ht,callback:e}):e()}function zt(){p="linepings";if(Nt==2)$t();else{var e=b?F:H;!D&&e.length<=1||!e.length?Jt():(i.setWinLines(e,b?!1:j),b&&(y&&qt(y),v&&v()),++O,i.startLinePings(Gt,I),l=!0,b?Nt==1||P?n.play({playwhat:"bonusping",soundLine:"fg1"}):n.play({playwhat:"bonusping"+O,soundLine:"fg"+(O%2+1)}):n.play({playwhat:"lineping"+((O-1)%12+1),soundLine:"fg"+(O%2+1)}),b?tt&&tt(F[0][0]):_&&_(H[0][0]))}}function Wt(){p="fgLinepings";if(!at){Pt();return}c=!0;var e=[],t=[];for(var r in at)at[r]&&(e.push(H[r]),t.push(j[r]));at=e,e.length?(O=1,it?n.muteBgSound():yt&&n.muteBgSound(!0),i.setWinLines(e,t),i.startLinePings(Yt,null,500),l=!0,n.play({playwhat:"FGlineping",soundLine:"fg2"}),nt&&nt(at[0][0])):(console.error("fgLinepings: wrong data!"),Pt())}function Xt(){p="stamp",rt&&rt(),c=!1;if(!g||b)Jt();else{l&&(un(),q&&q()),Rt(!1);if(mt){var e=mt;mt=null,e(Xt);return}et&&et();if($.isArray(s))for(var t in s)s[t].startStamping(on);else s.startStamping(on)}}function Vt(){p="stampReplace",rt&&rt(),c=!1;if(!S||!w||x)Jt();else{l&&(un(),q&&q()),et&&et();var e=vt;Rt(!1),w(function(t,n){typeof t!="undefined"&&t!==!1&&(H=t),typeof n!="undefined"&&(e=n);if(e){wt&&wt();for(var r in e)typeof U[r]!="undefined"&&U[r].addAnimationPositions(e[r]);qt(e)}x=!0,Jt()},e)}}function $t(){p="linepings";if(!Mt){console.error("need cwls for sound set 2!"),Jt();return}var e=Mt({winLineWinFactor:B,winSounds:R});Dt=e.sounds,Zt(H[0][0]),i.setWinLines(H,j),i.startLinePings(Zt,I,e.timings),l=!0}function Jt(){p="winAnim",rt&&rt(),!b&&H&&(Nt!=2&&(!A||H.length==1)||x)&&(i.setWinLines(H,j),i.startWinLines(I),l=!0),!b&&H&&A&&H.length==1&&_&&Nt!=2&&_(H[0][0],!0),typeof xt=="function"&&(xt(),xt=null),c=!0;if(b)m>=5?n.play({playwhat:"winBon5",callback:Kt}):m>=4?n.play({playwhat:"winBon4",callback:Kt}):m>=3?n.play({playwhat:"winBon3",callback:Kt}):n.play({playwhat:"winBon2",callback:Kt});else if(Nt!=2&&Nt!=1){var e=ot,t=o.playSymbolAnims(),s=o.useCoinShowers(),u=o.useSmallSounds();if(e>=25){if(t&&o.noSymbolAnimDuringHype()){i.setNoWinframeSymbolsDuringAnimFeature(!1);for(var a in vt)U[a]&&U[a].stop();var f=gt(!0);i.setWinLinesBlend(f)}Lt&&i.setAnimWinframeGloss(!1)}var d=function(){Kt();if(!St||!St()){if(t&&o.noSymbolAnimDuringHype()){i.setNoWinframeSymbolsDuringAnimFeature(!0);for(var e in vt)U[e]&&U[e].prepare(vt[e]);for(var e in vt)U[e]&&U[e].start()}var n=gt(!1);i.setWinLinesBlend(n),Lt&&i.setAnimWinframeGloss(!0)}},v={25:12867,50:17900,100:18050,200:23e3,500:28800};if(e>=50){var g={};e>=500?(g.s="sign4",g.w="win500",g.t=v[500],g.h="tl_legendarywin"):e>=200?(g.s="sign3",g.w="win200",g.t=v[200],g.h="tl_monsterwin"):e>=100?(g.s="sign2",g.w="win100",g.t=v[100],g.h="tl_megawin"):e>=50&&(g.s="sign1",g.w="win50",g.t=v[50],g.h="tl_bigwin"),s==="optimal"&&u==="plus"?n.play({playwhat:g.s,callback:function(){n.play({playwhat:"win50",callback:d})}}):n.play({playwhat:u?u==="plus"?"win50":"win25":g.w,callback:d,callbackTime:u?u==="plus"?v[50]:v[25]:g.t}),s&&(r.start(g.h,h),lt=!0)}else if(e>=25)n.play({playwhat:"win25",callback:d,callbackTime:v[25]}),s&&(r.start("tl_smallwin",h),lt=!0);else if(e>0){var y=!1;for(var w in Ot){var E=Ot[w];if(e>=E){n.play({playwhat:"win"+E,callback:Kt,callbackTime:At[E]}),y=!0;break}}y||Kt()}else Kt()}else if(Nt==1&&!S){var y=!1,e=ot;for(var T in Ot){E=Ot[T];if(e>=E){n.play({playwhat:"win"+E,callback:Kt,callbackTime:At[E]}),y=!0;break}}y||Kt()}else Kt()}function Kt(){S&&!x&&w?Vt():g&&!b?Xt():at?Wt():Pt()}function Qt(){return(!g||b)&&!at}function Gt(e){++O,O>(b?F.length:H.length)?Jt():(b?Nt==1||P?n.play({playwhat:"bonusping",soundLine:"fg1"}):n.play({playwhat:"bonusping"+O,soundLine:"fg"+(O%2+1)}):n.play({playwhat:"lineping"+((O-1)%M+1),soundLine:"fg"+(O%2+1)}),b?tt&&tt(e):_&&_(e))}function Yt(e){++O,!at||O>at.length?(un(),Pt()):(n.play({playwhat:"FGlineping",soundLine:"fg2"}),nt&&nt(e))}function Zt(e){++O,O>(b?F.length:H.length)?Jt():(n.play({playwhat:Dt["wl"+e]}),_&&_(e))}function en(e,t,n){e.documentName()==T["hype"]&&(r.clearListeners(r.onTimelineComplete,en),$("._wlid_darkening").css("opacity",0),vt&&C&&It(vt),Ut())}function tn(e,t,n){e.documentName()==T["hype"]&&(r.clearListeners(r.onSceneLoad,tn),r.addListener({type:r.onSceneLoad,callback:nn}),r.show("start",T.hype),$("._wlid_darkening").css("opacity",0))}function nn(e,t,n){e.documentName()==T["hype"]&&(r.clearListeners(r.onSceneLoad,nn),Kt())}function rn(e,t,n){e.documentName()==h&&(r.clearListeners(r.onSceneLoad,rn),Kt())}function sn(e,t,n){e.documentName()==h&&(r.clearListeners(r.onSceneLoad,sn),r.addListener({type:r.onSceneLoad,callback:rn}),r.show("start",h))}function on(){y&&It(y),g=!1,b=!0,O=0;var e=A&&F&&F.length>1?zt:Jt;e()}function un(){ot>=25&&(o.playSymbolAnims()&&o.noSymbolAnimDuringHype()&&i.setNoWinframeSymbolsDuringAnimFeature(!0),Lt&&i.setAnimWinframeGloss(!0)),i.stop(),l=!1}var t=this,n=null,r=null,i=null,s=null,o=null,u=null,a=null,f=!1,l=!1,c=!1,h="winanim",p=!1,d=!1,v=null,m=0,g=!1,y=null,b=!1,w=!1,E=!1,S=!1,x=!1,T=null,N=null,C=null,k=null,L=!1,A=!1,O=0,M=typeof e.linepingSoundsCount=="undefined"?10:e.linepingSoundsCount,_=null,D=!1,P=!1,H=null,B=null,j=null,F=null,I=null,q=null,R=null,U={},z={},W=!1,X={},V=0,J=0,K=!1,Q={},G={mpLogo:{container:$(".mpLogoBox .mpLogo"),position:[{x:0,y:0}],params:{loop:!1}}},Y=!1,Z=!1,et=null,tt=null,nt=null,rt=null,it=!1,st=0,ot=0,ut=!1,at=null,ft=0,lt=!1,ct=!1,ht=!1,pt=!1,dt=!1,vt=null,mt=null,gt=null,yt=!1,bt=!1,wt=null,Et=null,St=null,xt=null,Tt=null,Nt=3,Ct=3,kt=!1,Lt=!1,At={0:533,1:1183,3:1600,6:2134,10:2933,15:3467,20:4e3},Ot=[],Mt=null,_t=null,Dt=null;(function(e){n=e.sound,r=e.hype,i=e.winLines,s=e.reelEngine,o=e.devConf,u=e.cache,a=e.animManager,kt=o.useSmallSounds(),pt=e.enforceX25Sound,h=e.winanim,e.linepings&&(A=e.linepings),yt=e.ambiente,e.useSingleBonusPing&&(P=e.useSingleBonusPing);if(o.playSymbolAnims()){if(typeof e.animations!="undefined"){var t=jQuery.parseJSON(e.animations);for(var f in t)t[f].name=f,t[f].cache=e.cache,t[f].animManager=a,U[f]=new SymbolAnimation(t[f])}}else{W=!0;for(var f in e.optimalSlotAnimations)z[e.optimalSlotAnimations[f]]=!0;Q=e.optimalSlotBigAnimData,e.calcOptimalSlotAnimOpacity&&(K=e.calcOptimalSlotAnimOpacity)}typeof e.blockAnimations!="undefined"&&(T=e.blockAnimations),typeof e.stampAnimFunc=="function"&&(v=e.stampAnimFunc),Mt=e.cwls,_t=e.asas,Lt=e.slotConf.feature("gloss")&&o.noGlossDuringHype()&&o.animWinframeGloss(),typeof e.winSoundLength!="undefined"&&e.winSoundLength&&(At=e.winSoundLength);for(var l in At)Ot.push(parseInt(l));Ot.sort(function(e,t){return t-e})})(e),restartFreegameBGSound=function(){n.getActiveBGSound()?n.unmuteBgSound(!0):n.playBgSound("fgBackLoop",!1,!0)},restartBasegameBGSound=function(){yt&&(n.getActiveBGSound()?n.unmuteBgSound(!0):n.playBgSound("ambiente",!1,!0))},this.animate=function(e){f&&(console.error("start new animation while running old animation"),n.stop()),c&&t.stopWinLines(function(){}),e.onLinePingCallback&&typeof e.onLinePingCallback=="function"?_=e.onLinePingCallback:_=null,D=typeof e.enforceSingleLineping!="undefined"?e.enforceSingleLineping:!1,e.onBonusLinePingCallback&&typeof e.onBonusLinePingCallback=="function"?tt=e.onBonusLinePingCallback:tt=null,e.onFreeGameLinePingCallback&&typeof e.onFreeGameLinePingCallback=="function"?nt=e.onFreeGameLinePingCallback:nt=null,e.onWinLineCallback&&typeof e.onWinLineCallback=="function"?I=e.onWinLineCallback:I=null,e.onWinLineStopCallback&&typeof e.onWinLineStopCallback=="function"?q=e.onWinLineStopCallback:q=null,e.onStampCallback&&typeof e.onStampCallback=="function"?et=e.onStampCallback:et=null,e.onBreakPointCallback&&typeof e.onBreakPointCallback=="function"?rt=e.onBreakPointCallback:rt=null,e.retriggerFG&&typeof e.retriggerFG=="function"?mt=e.retriggerFG:mt=null,Y=e.onFinished,Z=typeof e.onAbortable=="function"?e.onAbortable:!1,it=e.freeGame,st=e.winFactor,ot=typeof e.winFactorBeforeStamp=="undefined"?e.winFactor:e.winFactorBeforeStamp,typeof e.cBellFactor!="undefined"&&e.cBellFactor!==!1&&(ut=e.cBellFactor),H=e.winLines,B=typeof e.winLineWinFactor!="undefined"?e.winLineWinFactor:!1,R=typeof e.winSounds!="undefined"?e.winSounds:!1,j=e.winLinesBlend,F=typeof e.winLinesStamp=="undefined"?null:e.winLinesStamp,ft=O=0,lt=!1,ct=e.fiveofakind,m=typeof e.stamp=="undefined"?0:e.stamp,g=m>0,y=g?e.stampAnims:null,f=!0,b=!1,x=!1,w=e.stampReplaceFunc,E=e.abortStampReplaceFunc,S=e.stampReplace,x=!1,ht=typeof e.x25=="undefined"?!1:e.x25,dt=typeof e.additionalWinAnims=="undefined"?!1:e.additionalWinAnims,vt=typeof e.symbolAnims=="undefined"?!1:e.symbolAnims,N=T&&typeof e.blockAnim=="undefined"?!1:e.blockAnim,C=typeof e.blockAnimCallback=="function"?e.blockAnimCallback:!1,k=typeof e.abortSpecificBlockAnimCallback=="function"?e.abortSpecificBlockAnimCallback:!1,at=e.freeGameLines,St=e.areAutospinsActive,xt=e.animateConsoleCounter,Tt=e.setWinIntoConsole,typeof e.soundSet!="undefined"&&(Ct=Nt=e.soundSet,e.ringSoundsetMode&&(Ct=e.ringSoundsetMode)),wt=e.bsa,Et=e.awa,e.getWinLinesBlend&&typeof e.getWinLinesBlend=="function"&&(gt=e.getWinLinesBlend),it&&(!yt||st>=6||typeof ht=="string")&&n.getActiveBGSound()&&!n.isBgMuted()&&n.muteBgSound(!0);if(vt||y)vt&&(!C||!N)&&It(vt),l=!0;d=!!mt,Ht()},this.abortWinAnim=function(e,t){if(!p){typeof t=="function"&&t();return}typeof t=="function"&&(Y=t);var u=!mt,a=!1,f=!1;n.getActiveSound("fg2")!="maxBetClick"&&n.getActiveSound("fg2")!="takeWin"&&n.getActiveSound("fg2")!="buttonClick"&&n.stop("fg2");switch(p){case"bell":!e&&!d&&(a=b?F:H,f=b?y:vt),c=!0,typeof Tt=="function"&&Tt(Qt()),Kt();break;case"five":!e&&!d&&(a=b?F:H,f=b?y:vt),vt=y=null,typeof Tt=="function"&&Tt(Qt()),lt&&(r.addListener({type:r.onSceneLoad,callback:sn}),r.show("reset",h),lt=!1);break;case"blockAnim":!e&&!d&&(a=b?F:H,f=b?y:vt),vt=y=null,typeof Tt=="function"&&Tt(Qt()),L&&typeof k=="function"?(k(),Kt()):(r.clearListeners(r.onTimelineComplete,en),r.addListener({type:r.onSceneLoad,callback:tn}),r.show("reset",T.hype));break;case"x25":!e&&!d&&(a=b?F:H),c=!0,typeof Tt=="function"&&Tt(Qt()),Kt();break;case"linepings":i.stop(),i.setWinLines(b?F:H,j),i.startWinLines(I),c=!0,Kt();break;case"winAnim":lt&&o.useCoinShowers()?(r.addListener({type:r.onSceneLoad,callback:sn}),r.show("reset",h),lt=!1):Kt();break;case"stamp":if($.isArray(s))for(var v in s)s[v].stopStamping();else s.stopStamping();break;case"fgLinepings":at=null,Kt();break;case"stampReplace":un(),E&&E(),x=!0,S=!1,Kt();break;default:Kt()}if(p=="fgLinepings"||p=="stampReplace")e=!1;e?(l&&(un(),q&&q()),d||(Rt(b),Et&&Et())):(a&&(i.setWinLines(a,j),i.startWinLines(I),c=!0),f&&(wt&&wt(),It(f),qt(f),vt=f))},this.abortWinlineStepping=function(e){un(),q&&q(),Rt(!0),Et&&Et(),typeof e=="function"&&e()},this.isAnimating=function(){return c},this.stopWinLines=function(e,t){c&&(un(),Rt(!0),typeof t=="undefined"&&(t=!1),q&&q(t)),e()},this.playAnimation=function(e,t,n,r,i){typeof i!="undefined"&&(d=i),typeof r!="undefined"&&r?U[e].prepare(t,r):U[e].prepare(t),U[e].start(typeof n=="object"?n:!1)},this.prepareAnimations=function(e,t){for(var n in e)U[n].prepare(e[n],t)},this.startAnimations=function(e){for(var t in e)U[t].start(e[t])},this.abortAnimation=function(e){U[e].isRunning()&&U[e].stop()},this.playExtraAnimations=function(e){for(var n in e){var r=e[n];if(!r)continue;typeof r=="object"&&typeof r.name!="undefined"&&(n=r.name);var i=typeof r=="object"&&typeof r.container!="undefined"?r.container:G[n].container,s=typeof r=="object"&&typeof r.position!="undefined"?r.position:G[n].position,o=typeof G[n]!="undefined"?G[n].params:{};if(typeof r=="object"&&typeof r.params!="undefined")for(var u in r.params)o[u]=r.params[u];t.playAnimation(n,s,o,i)}},this.playOptimalAnimation=function(e,t,n){typeof n!="undefined"&&(d=n);var r=null,i=V>0;for(var s in t){var f=t[s];if(typeof f.contBox!="undefined"){var l=f.contBox;r=l.next(),r.hasClass("symbolAnimLayer")||(l.after('<div class="symbolAnimLayer"></div>'),r=l.next(),o.use3DTransform()&&r.css(o.getSupportedTransform(),"translateZ(0)"))}else $(".symbolAnimLayer").length==0?($("._wlid_animBox").after('<div class="symbolAnimLayer"></div>'),r=$(".symbolAnimLayer"),o.use3DTransform()&&r.css(o.getSupportedTransform(),"translateZ(0)")):r=$(".symbolAnimLayer");var c=typeof f.elem=="string"?f.elem.substr(1):f.elem.attr("id").substr(1),h="_animSymbol"+c,p=h+"_Glow";r.append('<div class="animSymbol" id="'+p+'"></div>'),r.append('<div class="animSymbol" id="'+h+'"></div>');var v=$("#"+p),m=$("#"+h);X[V+"-"+e]=m,++V;var g=u.getCachedImg(e),y=u.getCachedImg(e+"Glow"),b={left:f.x,top:f.y,"background-image":"url("+g.src+")"},w={left:f.x,top:f.y,"background-image":"url("+y.src+")",opacity:0};if(typeof Q[e]!="undefined"){var E=Q[e],S=b.top+parseInt(E.o);b.top=S,w.top=S,b.height=E.h,w.height=E.h;if(typeof E.w!="undefined"){b.width=E.w,w.width=E.w;if(typeof E.ox!="undefined"){var x=b.left+parseInt(E.ox);b.left=x,w.left=x}}}v.css(b),m.css(w)}!i&&V&&(J=Date.now(),a.add("animateTwoPict_"+e,Ft))},this.stopOptimalAnimations=function(){_t&&_t(),$(".symbolAnimLayer").remove(),X={},V=0}};