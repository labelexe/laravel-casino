(window.webpackJsonp1554303064121=window.webpackJsonp1554303064121||[]).push([[4],{77:function(e,t,i){"use strict";i.r(t),i.d(t,"SkywindAnalytics",function(){return S});var n=i(1),r=i(22),s=i(10),o=i(17),a=i(0),c=i(24),p=i(7),u=i(8),d=i(3),h=i(2),m=i(20),g=i(32),l="n/a",S=function(){function e(){this.url="",this.eventsLog=[],this.gameLoadingTime=0,this.assetsLoadingTime=0,this.locale=Object(a.c)(s.a),this.server=Object(a.c)(r.a),this.splash=Object(a.c)(o.a),this.menuModel=Object(a.c)(c.a),this.device=Object(a.c)(u.a),this.wrapperModel=Object(a.c)(p.a),this.dispatcher=Object(a.c)(h.a),this.mode=this.wrapperModel.funMode?"fun":"real",this.brandId=this.wrapperModel.token.brandId||-1,this.playerCode=this.wrapperModel.token.playerCode||l,this.wrapperModel.getServerConfig().then(this.initialize.bind(this))}return e.prototype.initialize=function(e){var t=this;e.skywindAnalytics&&(this.url=e.skywindAnalytics,"performance"in window&&performance&&performance.setResourceTimingBufferSize&&performance.setResourceTimingBufferSize(300),this.dispatcher.on("ADD_TO_ANALYTICS",function(e){return t.eventsLog.push(e)}).on("ANALYTICS",this.onServerAnalytics,this),this.setPromiseForInitPost(),this.dispatcher.emit("ANALYTICS",this.getBasicData()))},e.prototype.setPromiseForInitPost=function(){var e=this,t=window.performance&&performance.timing&&performance.timing.navigationStart||Date.now();this.readyToInitPromise=new Promise(function(i){e.dispatcher.once("SPLASH_COMPLETE",function(){e.assetsLoadingTime=Date.now()-t,i()})}).then(function(){return new Promise(function(i){e.gameAPI=Object(a.c)(g.a).gameAPI,e.gameAPI||i(),e.gameAPI.addListener(m.a.GAME_LOADED,function(){e.gameLoadingTime=Date.now()-t,i()})})})},e.prototype.fetch=function(e){this.url&&fetch(this.url,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)})},e.prototype.send=function(e){var t=e[e.length-1];if(e.length>1){var i=e[0];t.options={dnsTime:i.dnsTime,requestDuration:i.requestDuration,responseTime:i.responseTime,sslTime:i.sslTime,tcpTime:i.tcpTime,timeToFirstByte:i.timeToFirstByte,totalTime:i.totalTime}}this.fetch(t)},e.prototype.getBasicData=function(){var e=this.menuModel.getVolume();return{brandId:this.brandId,isMobile:!0,mode:this.mode,name:document.title,origin:location.origin,playerCode:this.playerCode,sound:!!e,soundLevel:e,type:"start",wrapperVersion:this.wrapperModel.version}},e.prototype.getSpinData=function(e){for(var t=[],i=0,n=this.getServerTimings();i<n.length;i++){var r=n[i];t.push(this.parseSpinData(r,e))}return this.eventsLog=[],this.spinActionStage=e.isJackpot?"Jackpot":!1===e.roundEnded?"Feature":"Main game",t},e.prototype.parseSpinData=function(e,t){var i=e.domainLookupStart,r=e.domainLookupEnd,s=e.connectStart,o=e.connectEnd,a=e.responseStart,c=e.responseEnd,p=e.requestStart,u=e.secureConnectionStart,d=t?t.error:void 0,h=n.a({},this.getBasicData(),{dnsTime:r-i,errorCode:d?d.code||-1:0,gameId:this.server.getGameCode(),gameServer:this.server.getServerUrl(),gameSession:this.server.getSession().getSession(),name:document.title,requestDuration:t?t.time:0,requestId:t?t.params.requestId:-1,responseTime:c-a,spinActionStage:this.spinActionStage,sslTime:p-u,tcpTime:o-s,timeToFirstByte:a-p,totalTime:c-s,type:"spin"});return d&&(h.errorMessage=d.message||d),this.eventsLog.length&&(h.eventsLog=this.eventsLog),this.gameAPI&&(h.isTurboModeActive=!!this.gameAPI.getTurboMode(),h.isAutoSpinsActive=!!this.gameAPI.isAutoSpinsActive(),h.isContinuousSpinsActive=!!this.gameAPI.isContinuousSpinsActive()),h},e.prototype.getInitData=function(e){var t=function(){var e=devicePixelRatio||1,t=Object(d.h)(screen.width*e,screen.height*e),i=Object(d.h)(innerWidth*e,innerHeight*e);return{screenSize:t,viewportSize:i}}(),i=t.screenSize,r=t.viewportSize,s=function(){var e=f(),t=e.getContext("webgl")||e.getContext("experimental-webgl"),i=!!(t&&t instanceof WebGLRenderingContext);return{webgl1support:i,maxTextureSize:t&&i?t.getParameter(t.MAX_TEXTURE_SIZE):-1}}(),o=s.webgl1support,a=s.maxTextureSize;this.isWebSocket=1===this.server.mode;for(var c,p={assetsLoadingTime:this.assetsLoadingTime,benchmark:this.device.benchMarkScore,browser:this.device.getBrowser(),canvasMode:!this.device.isWebGLSupport,currency:this.wrapperModel.token.currency||e.params.startGameToken.currency||l,dpi:this.device.screenDensity,es6support:this.device.isES6Support,gameLoadingTime:this.gameLoadingTime,language:this.locale.getLocale(),maxTextureSize:a,operatingSystem:this.device.getOS(),orientation:this.device.isLandscape?"landscape":"portrait",pixelRatio:devicePixelRatio,protocol:this.isWebSocket?"WebSocket":"HTTP",referrer:document.referrer||l,screenSize:i,slowConnection:this.device.isSlowConnection,splashName:this.splash.splashName,type:"init",urlParams:this.device.getParams,userAgent:navigator.userAgent,viewportSize:r,webgl1support:o,webgl2support:(c=f().getContext("webgl2"),!!(c&&c instanceof window.WebGL2RenderingContext))},u=[],h=0,m=this.getSpinData(e);h<m.length;h++){var g=m[h];u.push(n.a({},g,p))}return u},e.prototype.onServerAnalytics=function(e){var t=this;"start"!==e.type?e.params?"init"===e.params.request?this.readyToInitPromise.then(function(){t.send(t.getInitData(e))}):"spin"===e.params.request?this.send(this.getSpinData(e)):"play"===e.type&&this.fetch(function(e){return{request:e.params.request,requestId:e.params.requestId,type:e.type}}(e)):this.fetch(e.error):this.fetch(e)},e.prototype.getResources=function(){var e,t,i=this.server.getServerUrl();this.isWebSocket?("function"==typeof URL?t=new URL(i):(t=document.createElement("a")).href=i,e=performance.getEntriesByType("resource").filter(function(e){return e.name.startsWith(t.origin)})):(e=performance.getEntriesByName(i,"resource"))&&e.length||console.warn("Error detect resource");return e},e.prototype.getServerTimings=function(){var e=[{domainLookupStart:0,domainLookupEnd:0,connectStart:0,connectEnd:0,responseStart:0,responseEnd:0,requestStart:0,secureConnectionStart:0}];if(!window.performance||"function"!=typeof performance.getEntriesByName)return e;var t=this.getResources();if(!t||!t.length)return e;"function"==typeof performance.clearResourceTimings&&performance.clearResourceTimings();for(var i=[],n=0,r=t;n<r.length;n++){var s=r[n],o=s,a=o.startTime,c=o.responseEnd;i.push({domainLookupStart:s.domainLookupStart||0,domainLookupEnd:s.domainLookupEnd||0,connectStart:s.connectStart||a||0,connectEnd:s.connectEnd||c||0,responseStart:s.responseStart||a||0,responseEnd:c||0,requestStart:s.requestStart||a||0,secureConnectionStart:s.secureConnectionStart||a||0})}return i},e=n.c([a.a],e)}();function f(){return document.createElement("canvas")}}}]);