(window.webpackJsonp1554303064121=window.webpackJsonp1554303064121||[]).push([[0],{100:function(t,e){t.exports=function(t){return'<div class="bns-panel-button">'+t.t("bns.playRealMoney")+"</div>"}},101:function(t,e,i){},102:function(t,e){t.exports=function(t){return'<div class="bns-mobile-notification"> <div class="bns-mobile-notification__tooltip f-bold bns-mobile-notification__timer bns-timer f-bold"></div> <div class="bns-mobile-button bns-mobile-button-bns i-button"></div></div>'}},103:function(t,e,i){},104:function(t,e){t.exports=function(t){return'<div class="bns-mobile-notification"> <div class="bns-mobile-notification__tooltip f-bold bns-mobile-notification__amount i-amount"></div> <div class="bns-mobile-button bns-mobile-button-real i-button"></div></div>'}},105:function(t,e,i){},106:function(t,e,i){},107:function(t,e,i){},79:function(t,e,i){"use strict";i.r(e);var o=i(1),n=i(4),s=i(9),r=i(10),a=i(3),p=i(0),u=i(12),l=i(7),h=i(25),c=i(29),d=function(t){function e(){var e=t.call(this)||this;e.isBNSMode=!1,e.isVisible=!0,e.isActive=!1,e.isRoundEnded=!0,e._amount=0,e._autoRedeemBalance=0,e.hasInit=!1,e.isProlong=!1,e.ls_key="offer",e.wrapperModel=Object(p.c)(l.a),e.moneyFormatter=new c.a,e.storageManager=Object(p.c)(h.a),e._isSkipAvailableRedeem=!1;var i=e.wrapperModel.token,o=i.playmode;i.currency;return e.isBNSMode="bns"===o,e}var i;return o.d(e,t),i=e,e.prototype.update=function(t){var e=new Date(t.expireAt).getTime(),i=e-Date.now()-1e3*t.expireCountdown;this.isProlong=this.hasInit&&t.rewardedAmount>this.rewardedAmount,console.log("TIMER DELTA",i),this.expireDate=e-i,this.rewardedAmount=t.rewardedAmount,this.updateAmount(t.amount,!0),this.exchangeRate=t.exchangeRate,this.expireCountdown=t.expireCountdown,this._redeemMinAmount=t.redeemMinAmount,this.expireCountdown=t.expireCountdown,this._redeemBalance=t.redeemBalance||t.amount,this.redeemCurrency=t.redeemCurrency,this.promoId=t.promoId,this.hasInit||(this.hasInit=!0)},e.prototype.updateAmount=function(t,e){void 0===e&&(e=!1),this._amount=t<0?0:t,this.isBNSMode&&e||(this.emit("BC_UPDATE_AMOUNT"),this.isProlong&&this.isActive&&(this.isProlong=!1,this.updateOfferPopup()))},e.prototype.invisible=function(){this.isBNSMode||(this.isVisible=!1,this.emit("BC_VISIBLE",!1))},e.prototype.updateOfferPopup=function(){this.isVisible||(this.isVisible=!0,this.emit("BC_VISIBLE",!0)),this.emit("OFFER-POPUP",!0),this.saveRewardedAmound()},Object.defineProperty(e.prototype,"expireTime",{get:function(){var t=this.expireDate-Date.now();return t<0?0:t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullAmount",{get:function(){return this.format(this._amount)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"redeemBalance",{get:function(){return this.formatWithCurrency(this._redeemBalance)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"redeemMinAmount",{get:function(){return this.format(this._redeemMinAmount)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isEligibleRedeem",{get:function(){return this._amount>=this._redeemMinAmount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"autoRedeemBalance",{get:function(){return this.formatWithCurrency(this._autoRedeemBalance)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"formattedExchangeRate",{get:function(){return this.formatWithCurrency(1e3*this.exchangeRate)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSkipAvailableRedeem",{get:function(){return this._isSkipAvailableRedeem},set:function(t){this._isSkipAvailableRedeem=t},enumerable:!0,configurable:!0}),e.prototype.isAvailableRedeem=function(){return!this.isBNSMode||(this.isRoundEnded||this._isSkipAvailableRedeem)},e.prototype.isExpired=function(){return this.expireTime<2e3&&this.isAvailableRedeem()},e.prototype.updateAutoRedeemBalance=function(t){this._autoRedeemBalance=t},e.prototype.formatWithCurrency=function(t){var e=new c.a;return e.setCurrencySymbol(this.redeemCurrency),e.formatNumber(t,i.getMoneyFormatterSettings(t))},e.prototype.activate=function(){if(!this.isActive){this.moneyFormatter.setCurrencySymbol("BNS");var t=this.readStorage(this.ls_key);this.isVisible=!0,t?+t<this.rewardedAmount&&this.updateOfferPopup():(!this.isBNSMode&&this.expireCountdown>1&&this.emit("OFFER-POPUP"),this.saveRewardedAmound()),this.emit("BC_UPDATE_AMOUNT"),this.isActive=!0}},e.prototype.saveRewardedAmound=function(){this.writeStorage(this.ls_key,this.rewardedAmount)},e.getMoneyFormatterSettings=function(t){return{decimalPartAppendType:0,shortMode:t>=(Math.floor(t)===t?1e6:1e3)}},e.prototype.format=function(t){return this.moneyFormatter.formatNumber(t,i.getMoneyFormatterSettings(t))},e.prototype.keepRedeemResponse=function(t){var e={id:this.promoId,result:t};this.storageManager.setItem("bns_redeem",JSON.stringify(e))},e.prototype.checkRedeemResponse=function(){var t=n.a.getUrlParam("promo_id"),e=this.storageManager.getItem("bns_redeem");if(t&&e){var i=JSON.parse(e);i.id===t&&i.result&&(this.redeemCurrency=i.result.redeemCurrency,this._autoRedeemBalance=i.result.redeemBalance,this.emit("SHOW_AUTOREDEEM_POPUP"),this.storageManager.removeItem("bns_redeem"))}},e.prototype.clear=function(){this.isActive=!1,this.isVisible=!0,this.hasInit=!1,this._amount=0,this.storageManager.removeItem(this.bnsKey)},e.prototype.getStorageData=function(){var t=this.storageManager.getItem(this.bnsKey);return t?JSON.parse(t):{}},e.prototype.writeStorage=function(t,e){void 0===e&&(e=null);var i=this.getStorageData();e?i[t]=e:delete i[t],this.storageManager.setItem(this.bnsKey,JSON.stringify(i))},e.prototype.readStorage=function(t){return this.getStorageData()[t]},Object.defineProperty(e.prototype,"bnsKey",{get:function(){return"bns_"+this.promoId},enumerable:!0,configurable:!0}),e=i=o.c([p.a],e)}(u.EventEmitter),m=i(6),f=i(15),b=i(31),y=function(){function t(){this.locale=Object(p.c)(r.a),this.model=Object(p.c)(d),this.gameDetector=Object(p.c)(b.a);var t=Object(p.c)(l.a).path,e=this.locale.getLocale();this.localePath=t+"i18n/"+e+"/"}return t.prototype.getInfoContent=function(){var t=this;if(this.infoText)return Promise.resolve(this.infoText);var e=Object(p.c)(f.PopupManager),i=e.showLoading();return m.a.loadText(this.localePath+"bns.html").then(function(o){return e.hide(i),t.infoText=o,o})},t.prototype.loadImages=function(){var t="zh-cn"===this.locale.getLocale(),e=[t?"bns-logo.zh-cn":"bns-logo","bns-shine","bns-button"],i=["bns-info",t?"bns-logo-small.zh-cn":"bns-logo-small"],o=[t?"bns-logo-bnsmode.zh-cn":"bns-logo-bnsmode"];return e.push(t?"m_menu_logo.zh-cn":"m_menu_logo","m-clock","m_menu_info"),i.push("m_menu_button_real"),o.push("m_menu_button_bns","m_bns-mode","m_bns-mode-short","m_button_clock"),m.a.loadImages(Object(s.e)(e.concat(this.model.isBNSMode?o:i).map(function(t){return t+".png"})))},t.prototype.loadFonts=function(){var t=document.fonts;if(!t)return Promise.resolve();var e=["1pt 'Noto Sans'","bold 1pt 'Noto Sans'","vi"===this.locale.getLocale()?"1pt vi-NotoSansCJKsc-Bold":"1pt Impact"].map(function(e){return t.load(e)});return Promise.all(e).catch(function(){return Promise.resolve()})},t.prototype.loadResources=function(){var t=[this.locale.loadPlugin("bns"),this.loadFonts(),this.loadImages(),this.gameDetector.detect()];return Promise.all(t)},t=o.c([p.a],t)}(),v=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.model=Object(p.c)(d),e}return o.d(e,t),e.prototype.prepareOptions=function(){return this.options.model=this.model,this.options.templateButton=i(82),t.prototype.prepareOptions.call(this)},e.prototype.getTemplate=function(){return i(85)},e}(i(13).a),_=i(2);i(86);var g=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.eventDispatcher=Object(p.c)(_.a),e}return o.d(e,t),e.prototype.show=function(){t.prototype.show.call(this),this.timerNode=this.overlay.querySelector(".bns-timer"),this.eventDispatcher.on("BC_UPDATE_TIMER",this.updateTimer,this)},e.prototype.hide=function(){this.eventDispatcher.off("BC_UPDATE_TIMER",this.updateTimer,this),this.timerNode=null,t.prototype.hide.call(this)},e.prototype.updateTimer=function(t){Object(a.n)(this.timerNode,t.full)},e}(v),E=function(t){function e(){var e,i=null!==t&&t.apply(this,arguments)||this;return i.events=((e={".i-info":i.info})[i.device.event.down+" .i-info"]=i.soundClick,e),i}return o.d(e,t),e.prototype.prepareOptions=function(){return this.options.buttons=this.model.isBNSMode?{title:"ok",action:this.playNow,sound:!0}:[{title:"bns.playBonusNow",action:this.playNow,sound:!0},{title:"bns.playLater",sound:!0}],t.prototype.prepareOptions.call(this)},e.prototype.playNow=function(){this.close(),this.model.isBNSMode||this.eventDispatcher.emit("BC_PLAY_NOW")},e.prototype.info=function(){this.close(),this.eventDispatcher.emit("BC_INFO_POPUP",this.options.caller)},e.prototype.getTemplate=function(){return this.options.timer=i(83),i(87)},e.prototype.addListeners=function(){t.prototype.addListeners.call(this),this.model.on("BC_UPDATE_AMOUNT",this.updateAmount,this)},e.prototype.removeListeners=function(){t.prototype.removeListeners.call(this),this.model.off("BC_UPDATE_AMOUNT",this.updateAmount,this)},e.prototype.updateAmount=function(){this.overlay.querySelector(".message").innerHTML=this.processField("",this.options.message)},e}(g),M=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o.d(e,t),e.prototype.getTemplate=function(){return this.options.timer=i(83),i(88)},e}(g),B=i(30),T=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.disabled=!1,e}return o.d(e,t),e.prototype.addListeners=function(){t.prototype.addListeners.call(this),this.eventDispatcher.on("POPUP_STATE_UPDATE",this.changeState,this)},e.prototype.changeState=function(t){this.disabled=t,Object(a.k)(this.el,t)},e}(B.a),P=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o.d(e,t),e.prototype.render=function(){var e=t.prototype.render.call(this);return this.timerNode=this.el.querySelector(".bns-timer"),e},e.prototype.addListeners=function(){t.prototype.addListeners.call(this),this.eventDispatcher.on("BC_UPDATE_TIMER",this.updateTimer,this)},e.prototype.removeListeners=function(){t.prototype.removeListeners.call(this),this.eventDispatcher.off("BC_UPDATE_TIMER",this.updateTimer,this)},e.prototype.destroy=function(){this.timerNode=null,t.prototype.destroy.call(this)},e.prototype.updateTimer=function(t){Object(a.n)(this.timerNode,t.full),this.el.classList.toggle("hot",t.hot)},e}(B.a),O=(i(89),function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.model=Object(p.c)(d),e.disabled=!1,e.events=e.model.isBNSMode?{}:{".i-amount-area":e.click},e}return o.d(e,t),e.prototype.render=function(){return t.prototype.render.call(this),this.toolTipElement=this.el.querySelector(".tooltip-timer"),this.amountElement=this.el.querySelector(".i-amount"),this.updateAmount(),e.setParentNodeState(!0),this.el},e.prototype.destroy=function(){e.setParentNodeState(!1),this.toolTipElement=null,this.amountElement=null,t.prototype.destroy.call(this)},e.prototype.getTemplate=function(){return i(90)},e.prototype.addListeners=function(){t.prototype.addListeners.call(this),this.model.on("BC_UPDATE_AMOUNT",this.updateAmount,this),this.model.isBNSMode||(this.model.on("BC_VISIBLE",this.setVisible,this),this.eventDispatcher.on("POPUP_STATE_UPDATE",this.changeState,this))},e.prototype.removeListeners=function(){t.prototype.removeListeners.call(this),this.model.off("BC_UPDATE_AMOUNT",this.updateAmount,this),this.model.isBNSMode||(this.model.off("BC_VISIBLE",this.setVisible,this),this.eventDispatcher.off("POPUP_STATE_UPDATE",this.changeState,this))},e.prototype.updateTimer=function(e){t.prototype.updateTimer.call(this,e),Object(a.n)(this.timerNode,e.short),Object(a.n)(this.toolTipElement,e.full)},e.setParentNodeState=function(t){document.querySelector(".footer-panel").classList.toggle("bns-notification",t)},e.prototype.click=function(){this.disabled||this.eventDispatcher.emit("BC_NOTIFICATION")},e.prototype.updateAmount=function(){Object(a.n)(this.amountElement,this.model.fullAmount)},e.prototype.changeState=function(t){this.disabled=t,Object(a.k)(this.el,t)},e.prototype.setVisible=function(t){Object(a.l)(this.el,!t),e.setParentNodeState(t)},e}(P)),A=(i(91),function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.events={".i-close":e.close,"mousedown .i-close":e.playSound},e}return o.d(e,t),e.prototype.getTemplate=function(){return i(92)},e.prototype.render=function(){return t.prototype.render.call(this),this.closeTimer=setTimeout(this.close.bind(this),5e3),this.playSound(),this.el},e.prototype.close=function(){clearTimeout(this.closeTimer),this.el.classList.add("bns-bubble--hide"),setTimeout(this.destroy.bind(this),2e3)},e.prototype.playSound=function(){this.eventDispatcher.emit("BUTTON_CLICK")},e}(B.a)),S=(i(93),function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.events={".i-redeem":e.redeem,".i-info":e.info},e}return o.d(e,t),e.prototype.render=function(){var e=t.prototype.render.call(this),i=new O({cssClass:"bns-panel__item bns-panel__balance",amount:""});return e.insertBefore(i.render(),e.firstChild),setTimeout(this.tooltip.bind(this),1500),e},e.prototype.tooltip=function(){var t=new A;this.el.querySelector(".bns-notification__value").appendChild(t.render())},e.prototype.redeem=function(){this.disabled||this.eventDispatcher.emit("BC_REDEEM")},e.prototype.info=function(){this.disabled||this.eventDispatcher.emit("BC_INFO_POPUP")},e.prototype.getTemplate=function(){return i(94)},e}(T)),C=(i(95),function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.model=Object(p.c)(d),e.events=e.model.isBNSMode?{".i-info":e.info,".i-redeem":e.redeem,".i-go-back":e.realMode}:{".i-info":e.info,".i-play-now":e.playNow},e}return o.d(e,t),e.prototype.addListeners=function(){t.prototype.addListeners.call(this),this.model.isBNSMode||this.model.on("BC_UPDATE_AMOUNT",this.updateAmount,this)},e.prototype.removeListeners=function(){t.prototype.removeListeners.call(this),this.model.isBNSMode||this.model.off("BC_UPDATE_AMOUNT",this.updateAmount,this)},e.prototype.render=function(){var e=t.prototype.render.call(this);return this.model.isBNSMode||(this.amountElement=e.querySelector(".i-amount"),this.updateAmount()),this.eventDispatcher.emit("MENU_SET_OPTIONS",{scrollHeader:!0}),e},e.prototype.destroy=function(){this.model.isBNSMode||(this.amountElement=null),this.eventDispatcher.emit("MENU_SET_OPTIONS",{scrollHeader:!1}),t.prototype.destroy.call(this)},e.prototype.getTemplate=function(){var t=this.model.isBNSMode,e=t?[{title:"bns.playRealMoney",cssClass:"i-go-back",sound:!0},{title:"bns.redeem",cssClass:"i-redeem m-redeem",sound:!0}]:[{title:"bns.playBonusNow",cssClass:"i-play-now",sound:!0}];return this.options={buttons:e,isBNSMode:t,templateButton:i(82),btn:i(35)},i(96)},e.prototype.updateAmount=function(){Object(a.n)(this.amountElement,this.model.fullAmount)},e.prototype.action=function(t){this.eventDispatcher.emit("MENU_CLOSE"),this.eventDispatcher.emit(t)},e.prototype.playNow=function(){this.action("BC_PLAY_NOW")},e.prototype.info=function(){this.action("BC_INFO_POPUP")},e.prototype.realMode=function(){this.action("BC_SWITCH_MODE")},e.prototype.redeem=function(){this.action("BC_REDEEM")},e}(P)),N=i(22),I=i(23),U=function(){function t(){this.server=Object(p.c)(N.a),this.model=Object(p.c)(d),this.wrapperModel=Object(p.c)(l.a),this.popupManager=Object(p.c)(f.PopupManager),this.dispatcher=Object(p.c)(_.a),this.addListeners(),this.remapErrorMessages(),this.model.isBNSMode&&this.server.setSettings({jpUpdateBalance:!1})}return t.prototype.switchMode=function(t,e){var i=this,o=this.wrapperModel.startGameToken,n=this.popupManager.showLoading();this.server.genericRequest({startGameToken:o,request:"choose-game",playmode:t},{hasRequestId:!1}).then(function(t){var i=t.url,o=e?"&promo_id="+e:"";location.href=""+i+o+"&ac="+Date.now()}).catch(function(){i.popupManager.hide(n)})},t.prototype.redeem=function(t){var e=this,i={request:"redeem-bns"},n=this.popupManager.showLoading();return this.server.genericRequest(t?o.a({manual:!0},i):i,{hasRequestId:!1}).then(function(t){return e.model.isBNSMode||e.updateVisualBalance(t),e.popupManager.hide(n),t.result}).catch(function(t){return console.log(t),e.popupManager.hide(n),Promise.reject()})},t.prototype.updateBalance=function(){var t=this;return this.server.balanceRequest().then(function(e){return t.model.isBNSMode||t.updateVisualBalance(e),e})},t.prototype.isExpired=function(){return this.updateBalance().then(function(t){var e=t.balance.bonusCoins;return!e||e.expireCountdown<2})},t.prototype.remapErrorMessages=function(){var t,e,i=this,o=Object(p.c)(I.a);if(o.add(((t={})[519]={message:"bns.error.notEnoughBnsToRedeem",buttons:{title:"ok"}},t[691]={message:"bns.error.insufficientBonusCoinsBalance",buttons:{title:"refresh",actionEvent:"RELOAD"}},t)),this.model.isBNSMode){var n={title:"ok",action:function(){return i.switchMode("real")}};o.add(((e={})[681]={message:"bns.error.promotionHasExpired",buttons:n},e[521]={message:"bns.error.roundNotFinished",buttons:{title:"ok"}},e[690]={message:"bns.error.bonusCoinsNotAvailable",buttons:n},e))}},t.prototype.addListeners=function(){this.dispatcher.on("SERVER_RESPONSE",this.onServerResponse,this)},t.prototype.updateVisualBalance=function(t){this.dispatcher.emit("UPDATE_VISUAL_BALANCE",t.balance)},t.prototype.onServerResponse=function(t){void 0!==t.roundEnded&&(this.model.isRoundEnded=t.roundEnded)},t}(),R=i(8),w=(i(97),function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.model=Object(p.c)(d),e.gameType=Object(p.c)(b.a).features.mark,e.isUsingInnerScaleMethod=!0,e}return o.d(e,t),e.prototype.addListeners=function(){t.prototype.addListeners.call(this),this.model.on("BC_UPDATE_AMOUNT",this.updateAmount,this),this.eventDispatcher.on("RESIZE",this.onResize,this).on("BC_UI_UPDATE",this.updateUI,this)},e.prototype.removeListeners=function(){t.prototype.removeListeners.call(this),this.model.off("BC_UPDATE_AMOUNT",this.updateAmount,this),this.eventDispatcher.off("RESIZE",this.onResize,this).off("BC_UI_UPDATE",this.updateUI,this)},e.prototype.destroy=function(){this.amountElement=null,t.prototype.destroy.call(this)},e.prototype.render=function(){return t.prototype.render.call(this),this.multiline(4===this.gameType),this.amountElement=this.el.querySelector(".i-amount"),this.updateAmount(),this.onResize(),this.el},e.prototype.getTemplate=function(){return i(98)},e.prototype.updateAmount=function(){Object(a.n)(this.amountElement,this.model.fullAmount),this.scaleAmount()},e.prototype.scaleAmount=function(){var t=getComputedStyle(this.amountElement.parentElement),e=parseFloat(t.width);Object(a.e)(this.amountElement,1,e,"em",.01),this.amountElement.style.lineHeight=t.height},e.prototype.onResize=function(){var t=4===this.gameType,e=this.device.getScreenResolution(),i=e.isLandscape?t?1780:1350:760,o=Math.min(e.width/i,.8),n=t?Math.min(20.267*o,14.7):20.267*o,s=this.el.style;s.fontSize=n+"px",s.top=e.height+"px",this.scaleAmount()},e.prototype.onUpdateBalanceBounds=function(t){this.isUsingInnerScaleMethod&&(this.isUsingInnerScaleMethod=!1,this.eventDispatcher.off("RESIZE",this.onResize,this)),Object(a.d)(this.el,t,!0),this.scaleAmount()},e.prototype.show=function(){t.prototype.show.call(this),this.scaleAmount()},e.prototype.multiline=function(t){Object(a.j)(this.el,"bns-mobile-panel-short",t)},e.prototype.updateUI=function(t){var e=t.bonusCoinsUIVisibility,i=t.balancePanelVisibility,o=t.balancePanelBounds,n=t.multilineBalancePanel;t.disabledBalancePanel?this.destroy():(void 0!==e&&(this.visible=e),void 0!==i&&(this.visible=i),void 0!==o&&this.onUpdateBalanceBounds(o),void 0!==n&&(this.multiline(n),this.scaleAmount()))},e}(B.a)),D=(i(99),function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.events={this:e.back},e}return o.d(e,t),e.prototype.back=function(){this.disabled||this.eventDispatcher.emit("BC_SWITCH_MODE")},e.prototype.getTemplate=function(){return i(100)},e}(T)),L=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.events={".i-button":e.openMenu},e}return o.d(e,t),e.prototype.render=function(){return this.eventDispatcher.emit("MENU_SET_OPTIONS",{hideButton:!0,lockButtonState:!0}),t.prototype.render.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.eventDispatcher.emit("MENU_SET_OPTIONS",{hideButton:!1,lockButtonState:!1})},e.prototype.addListeners=function(){t.prototype.addListeners.call(this),this.eventDispatcher.on("BC_UI_UPDATE",this.updateUI,this).on("MENU_STATE",this.onMenuState,this).on("MENU_VISIBILITY",this.onMenuVisible,this)},e.prototype.removeListeners=function(){t.prototype.removeListeners.call(this),this.eventDispatcher.off("BC_UI_UPDATE",this.updateUI,this).off("MENU_STATE",this.onMenuState,this).off("MENU_VISIBILITY",this.onMenuVisible,this)},e.prototype.openMenu=function(){this.eventDispatcher.emit("MENU_OPEN")},e.prototype.onMenuState=function(t){var e=t.enabled;void 0!==e&&Object(a.k)(this.el,!e)},e.prototype.onUpdateMenuBounds=function(t){var e=this.el;Object(a.d)(e,t)},e.prototype.updateUI=function(t){var e=t.menuButtonBounds,i=t.bonusCoinsUIVisibility,o=t.disabledBNSMenu;void 0!==i&&(this.visible=i),void 0!==e&&this.onUpdateMenuBounds(e),o&&this.destroy()},e}(B.a),k=(i(84),i(101),function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o.d(e,t),e.prototype.render=function(){var e=t.prototype.render.call(this);return this.timerNode=this.el.querySelector(".bns-timer"),e},e.prototype.getTemplate=function(){return i(102)},e.prototype.addListeners=function(){t.prototype.addListeners.call(this),this.eventDispatcher.on("BC_UPDATE_TIMER",this.updateTimer,this)},e.prototype.removeListeners=function(){t.prototype.removeListeners.call(this),this.eventDispatcher.off("BC_UPDATE_TIMER",this.updateTimer,this)},e.prototype.destroy=function(){this.timerNode=null,t.prototype.destroy.call(this)},e.prototype.updateTimer=function(t){Object(a.n)(this.timerNode,t.short)},e.prototype.onMenuVisible=function(t){Object(a.l)(this.el,t)},e}(L)),x=(i(103),function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.model=Object(p.c)(d),e}return o.d(e,t),e.prototype.render=function(){var e=t.prototype.render.call(this);return this.amountElement=e.querySelector(".i-amount"),this.updateAmount(),e},e.prototype.destroy=function(){this.amountElement?(this.amountElement=null,t.prototype.destroy.call(this),this.eventDispatcher.emit("SHOW_GAME_MENUBUTTON",!1)):this.eventDispatcher.emit("BC_HIDE_CUSTOM_REAL_BUTTON")},e.prototype.getTemplate=function(){return i(104)},e.prototype.addListeners=function(){t.prototype.addListeners.call(this),this.model.on("BC_VISIBLE",this.setVisible,this).on("BC_UPDATE_AMOUNT",this.updateAmount,this)},e.prototype.removeListeners=function(){t.prototype.removeListeners.call(this),this.model.off("BC_VISIBLE",this.setVisible,this).off("BC_UPDATE_AMOUNT",this.updateAmount,this)},e.prototype.updateAmount=function(){Object(a.n)(this.amountElement,this.model.fullAmount),Object(a.e)(this.amountElement,13,86)},e.prototype.setVisible=function(t){Object(a.l)(this.el,!t),this.eventDispatcher.emit("SHOW_GAME_MENUBUTTON",!t)},e.prototype.onMenuVisible=function(t){this.setVisible(!t)},e}(L));i(36),i(105),i(106);i.d(e,"BonusCoins",function(){return j}),i(107);var j=function(){function t(){this.locale=Object(p.c)(r.a),this.model=Object(p.c)(d),this.server=new U,this.popupManager=Object(p.c)(f.PopupManager),this.loader=Object(p.c)(y),this.dispatcher=Object(p.c)(_.a),this.currentPopupId="",this.hasBonusCoins=!1,this.isInit=!1,this.isMenuShow=!1,this.highlightExpirationTimer=+n.a.getUrlParam("bns_expiration_timer")||5,this.initialize()}return t.prototype.ready=function(){return this.loader.loadResources()},t.prototype.initialize=function(){this.checkIsOfferOnGamePlay(),this.highlightExpirationTimer=36e5*Math.abs(this.highlightExpirationTimer)+6e4,this.addListeners()},t.prototype.addListeners=function(){this.dispatcher.on("BC_EXPIRED",this.expired,this).on("BC_PLAY_NOW",this.playNow,this).on("BC_SWITCH_MODE",this.realMode,this).on("MENU_STATE",this.onMenuChange,this).on("BC_REDEEM",this.onRedeemAction,this).on("BC_INFO_POPUP",this.showInfoPopup,this).on("BALANCE_UPDATE",this.balanceUpdate,this).on("BC_OFFER_POPUP",this.showOfferPopup,this).on("BC_STATUS_POPUP",this.showStatusPopup,this).on("BC_NOTIFICATION",this.showStatusPopup,this).on("UPDATE_BALANCE",this.updateBnsBalance,this).on("FORCE_BC_UI_UPDATE",this.updateTimer,this).once("BC_SKIP_AVAILABLE_REDEEM_CHECK",this.onSkipAvailableRedeemCheck,this),this.model.on("OFFER-POPUP",this.showOfferPopup,this).on("SHOW_AUTOREDEEM_POPUP",this.showAutoRedeemPopup,this)},t.prototype.balanceUpdate=function(t){var e=t.bonusCoins;this.hasBonusCoins=!!e,this.hasBonusCoins?(console.log("BNS: Update model"),this.model.update(e),this.isInit||this.init(),this.isOfferOnGameplay&&this.isMenuShow&&!this.model.isActive&&(this.isOfferOnGameplay=!1,this.activate())):this.isInit&&this.model.invisible()},t.prototype.init=function(){this.model.isBNSMode&&this.bnsUI(),this.isInit=!0},t.prototype.onMenuChange=function(t){t.visible&&(this.dispatcher.off("MENU_STATE",this.onMenuChange,this),this.model.isBNSMode||this.model.checkRedeemResponse(),this.isMenuShow=!0,this.hasBonusCoins&&this.activate())},t.prototype.onSkipAvailableRedeemCheck=function(){this.model.isSkipAvailableRedeem=!0},t.prototype.activate=function(){this.model.isActive||(this.model.isBNSMode?this.updateBonusCoinsUI():this.showNotification(),this.model.activate(),this.startTimer())},t.prototype.showPopup=function(t,e,i){this.currentPopupId=this.popupManager.show(t,e,i)},t.prototype.showOfferPopup=function(t){this.showPopup(6,{cssClass:"offer-popup",isOffer:!0,clock:this.clock().full,caller:"BC_OFFER_POPUP",title:t?"":"bns.congratulations",message:t?"bns.offerUpdateMessage":"bns.offerMessage"},E)},t.prototype.showStatusPopup=function(){this.showPopup(6,{cssClass:"bns-popup--light",clock:this.clock().full,caller:"BC_STATUS_POPUP",message:"bns.offerMessage"},E)},t.prototype.showInfoPopup=function(t){var e=this;this.loader.getInfoContent().then(function(o){e.showPopup(4,{cbClose:function(){t&&e.dispatcher.emit(t)},buttons:[],templateButton:i(82),content:o,className:"bns-popup bns-info-popup",hideOverlay:!1,params:{bns:e.model.redeemMinAmount,rate:e.model.formattedExchangeRate}})})},t.prototype.updateTimer=function(){this.dispatcher.emit("BC_UPDATE_TIMER",this.clock())},t.prototype.startTimer=function(){this.updateTimer(),this.model.isExpired()?this.checkExpiration():setTimeout(this.startTimer.bind(this),this.model.expireCountdown?6e3:500)},t.prototype.checkExpiration=function(){var t=this;console.log("BNS: Check Balance Before Expire"),this.server.isExpired().then(function(e){e?t.dispatcher.emit("BC_EXPIRED"):t.startTimer()})},t.prototype.clock=function(){var t=this.model.expireTime,e=new Date(t),i=Math.floor(t/864e5),o=e.getUTCHours(),n=e.getUTCMinutes(),r=Object(s.b)(o,n),a=i>0?i+"d "+r:r;return{short:a,full:a+" "+this.locale.plural("bns.hour",o),hot:t<=this.highlightExpirationTimer}},t.prototype.playNow=function(){this.server.switchMode("bns")},t.prototype.realMode=function(){var t=this;this.showPopup(6,{cssClass:"bns-popup--info",message:"bns.realModeQuestion",buttons:[this.popupButton("yes",function(){t.hideCurrentPopup(),t.popupManager.showLoading(),t.goToRealMode()}),this.popupButton("no")]},v)},t.prototype.showNotification=function(){this.model.expireTime&&(this.notification=new x,this.dispatcher.emit("ADD_MENU_WIDGET",{widget:this.notification}),this.dispatcher.emit("BC_CREATE_BUTTON_BNS_MOBILE"),this.updateMobileMenu())},t.prototype.expired=function(){this.model.isBNSMode?(this.onBCReadyToRedeem(),this.showExpirationPopup()):this.model.isEligibleRedeem?this.redeem(!1):this.destroy()},t.prototype.showExpirationPopup=function(){var t=this,e=this.model.isEligibleRedeem,i={cssClass:"bns-popup--info",message:e?"bns.expirationEligible":"bns.expirationNotEligible",buttons:this.popupButton("ok",function(){e?(t.popupManager.hideAll(),t.redeem(!1)):t.goToRealMode()})};this.model.isBNSMode&&this.popupManager.hideAll(),this.showPopup(6,i,v)},t.prototype.goToRealMode=function(t){this.server.switchMode("real",t)},t.prototype.hideCurrentPopup=function(){this.popupManager.hide(this.currentPopupId)},t.prototype.destroy=function(){this.currentPopupId&&this.hideCurrentPopup(),this.notification&&(this.notification.destroy(),this.notification=null),this.menuMobileItem&&(this.menuMobileItem.destroy(),this.menuMobileItem=null),this.model.clear(),this.isInit=!1,this.checkIsOfferOnGamePlay()},t.prototype.updateMobileMenu=function(){var t=this;this.menuMobileItem=new C,this.dispatcher.emit("ADD_MENU_WIDGET",{insert:!0,widget:this.menuMobileItem,selector:".menu-list-item:first-child"}),setTimeout(function(){t.dispatcher.emit("SHOW_GAME_MENUBUTTON",!1)},0)},t.prototype.updateBonusCoinsUI=function(){this.mobileBNSMode()},t.prototype.onBCReadyToRedeem=function(){this.model.isSkipAvailableRedeem&&this.dispatcher.emit("BC_READY_TO_REDEEM")},t.prototype.onRedeemAction=function(){this.model.isAvailableRedeem()?this.showRedeemPopup():this.popupManager.error({message:"bns.error.roundNotFinished",buttons:{title:"ok"}})},t.prototype.showRedeemPopup=function(){var t=this,e=this.clock().full,i=this.model.isEligibleRedeem?{clock:e,cssClass:"bns-popup--light",message:"bns.redeemEligible",buttons:[this.popupButton("yes",function(){t.onBCReadyToRedeem(),t.redeem(!0)}),this.popupButton("no")]}:{clock:e,message:"bns.redeemNotEligible",buttons:this.popupButton("ok")};this.showPopup(6,i,M)},t.prototype.desktopBNSMode=function(){this.dispatcher.emit("ADD_MENU_WIDGET",{widget:new S,selector:".footer-panel-widget"}),this.dispatcher.emit("ADD_MENU_WIDGET",{widget:new D,selector:".footer-panel-col:last-child",insert:!0})},t.prototype.mobileBNSMode=function(){this.notification=new k,this.dispatcher.emit("ADD_MENU_WIDGET",{widget:this.notification}),this.updateMobileMenu(),Object(a.l)(".menu-list-item-cashier"),this.dispatcher.emit("BC_CREATE_BUTTON_BNS_MOBILE"),this.balanceWidget=new w,Object(p.c)(R.a).gameWrapper.appendChild(this.balanceWidget.render()),this.dispatcher.emit("BC_CREATE_PANEL_BNS_MOBILE")},t.prototype.autoRedemptionPopup=function(){this.showPopup(6,{cssClass:"bns-popup--auto-redeem",title:"bns.congratulations",message:"bns.autoRedemptionMessage",buttons:this.popupButton("ok",this.destroy)},v)},t.prototype.redeem=function(t){var e=this;this.hideCurrentPopup(),this.server.redeem(t).then(function(t){e.model.isBNSMode?(e.popupManager.hideAll(),e.model.keepRedeemResponse(t),e.model.clear(),e.goToRealMode(e.model.promoId)):(e.model.updateAutoRedeemBalance(t.redeemBalance),e.autoRedemptionPopup())}).catch(function(){e.model.isBNSMode||e.destroy()})},t.prototype.showAutoRedeemPopup=function(){var t=this;this.server.updateBalance().then(function(){t.autoRedemptionPopup()})},t.prototype.bnsUI=function(){0},t.prototype.popupButton=function(t,e){var i={title:t,sound:!0};return e&&(i.action=e.bind(this)),i},t.prototype.updateBnsBalance=function(t,e){this.model.isBNSMode&&this.model.updateAmount(e)},t.prototype.checkIsOfferOnGamePlay=function(){this.isOfferOnGameplay="0"!==n.a.getUrlParam("bns_offer_popup_on_gameplay")},t=o.c([p.a],t)}()},82:function(t,e){t.exports=function(t){var e="";return t.title.indexOf("\n")>-1&&(t.title=t.title.replace("\n","<br>"),t.cssClass+=" two-lines"),e+='<div class="generic-button bns-button '+t.cssClass+'"> <span class="bns-button_text">'+t.title+"</span></div>"}},83:function(t,e){t.exports=function(t){return'<div class="popup-footer__timer"> '+t.t("bns.offerExpires")+' <span class="bns-timer f-bold">'+t.clock+"</span></div>"}},84:function(t,e,i){},85:function(t,e){t.exports=function(t){var e='<div class="popup-overlay"> <div class="wrapper-popup bns bns-popup f-bold';return t.cssClass&&(e+=" "+t.cssClass),e+='"> ',t.title&&(e+=' <div class="title">'+t.title+"</div> "),e+=" ",t.message&&(e+=' <h2 class="message">'+t.message+"</h2> "),e+=" "+t.btn(t)+" </div></div>"}},86:function(t,e,i){},87:function(t,e){t.exports=function(t){var e='<div class="popup-overlay"> <div class="wrapper-popup bns-popup f-bold';return t.cssClass&&(e+=" "+t.cssClass),t.model.isBNSMode||(e+=" m-large-button"),e+='"> ',t.title&&(e+=' <div class="title">'+t.title+"</div> "),e+=' <div class="message">'+t.message+"</div> "+t.btn(t)+' <div class="popup-footer l-inline"> '+t.timer(t)+' <div class="popup-footer__info i-info">[i]</div> </div> </div></div>'}},88:function(t,e){t.exports=function(t){var e='<div class="popup-overlay"> <div class="wrapper-popup bns bns-popup f-bold';return t.cssClass&&(e+=" "+t.cssClass),e+='"> <div class="message">'+t.message+"</div> "+t.btn(t)+' <div class="popup-footer l-single">'+t.timer(t)+"</div> </div></div>"}},89:function(t,e,i){},90:function(t,e){t.exports=function(t){return'<div class="bns-notification '+t.cssClass+'"> <div class="bns-notification__value i-amount-area"><span class="i-amount bns-notification__amount f-bold"></span></div> <div class="bns-notification__timer"> <span class="bns-timer f-bold"></span> <div class="bns-notification__tooltip">'+t.t("bns.offerExpires")+' <b class="tooltip-timer"></b> </div> </div></div>'}},91:function(t,e,i){},92:function(t,e){t.exports=function(t){return'<div class="bns-bubble"> <div class="bns-bubble__close i-close"></div> '+t.t("bns.bubbleNotification")+"</div>"}},93:function(t,e,i){},94:function(t,e){t.exports=function(t){return'<div class="footer-item bns-panel"> <div class="bns-panel__item bns-panel__redeem i-redeem">'+t.t("bns.redeem")+'</div> <div class="bns-panel__item bns-panel__info i-info">[i]</div></div>'}},95:function(t,e,i){},96:function(t,e){t.exports=function(t){var e='<li class="menu-list-item bns-menu bns-buttons';return t.isRealMode&&(e+=" bns-real-mode"),e+='"> ',t.isBNSMode||(e+=' <div class="bns-menu__amount f-bold bns-menu__amount-value i-amount"></div> '),e+=" "+t.btn(t)+' <div class="bns-menu__footer"> <div class="bns-menu__timer"> '+t.t("bns.offerExpires")+' <span class="bns-timer f-bold"></span> </div> <div class="bns-menu__info i-info">[i]</div> </div></li>'}},97:function(t,e,i){},98:function(t,e){t.exports=function(t){var e='<div class="bns-mobile-panel';return t.cssClass&&(e+=" "+t.cssClass),e+='"> <div class="bns-mobile-panel__amount"><span class="bns-mobile-panel__value i-amount"></span></div></div>'}},99:function(t,e,i){}}]);