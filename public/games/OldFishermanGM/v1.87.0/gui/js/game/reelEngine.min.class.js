/**
 * class animating the reel engine
 * @copyright LoCoNET GmbH 2014-06-16
 */function ReelEngine(e){function lt(){--a,a==0&&m&&z&&z()}function ct(e,t){for(var n in window.HYPE_eventListeners){var r=window.HYPE_eventListeners[n];typeof r!="undefined"&&r.type==e&&r.callback(ft,{},t)}}function ht(e){var t=0;for(var n in O){if(!(O[n][0]<e))break;t=parseInt(n)}var r=0;if(t>=O.length-1)r=O[t][1];else{var i=(e-O[t][0])/(O[t+1][0]-O[t][0]);r=(1-i)*O[t][1]+i*O[t+1][1]}return r}function pt(e){for(var n=0;n<o;++n){if(!y[n])continue;var r=e*g,i=1*N[n]/g-M;N[n]<r&&(r=N[n]);if(e<i){var u=ot[n],a=x[n]+s+1;for(var f=x[n];f<=a;++f)t.setSymbol(L[n][f],u[f-x[n]]);for(var l=x[n]+s+2;l<=T[n];++l)L[n][l].remove(),delete L[n][l],delete A[n][l];T[n]>x[n]+s+1&&(T[n]=x[n]+s+1),ut[n]=N[n]-Math.ceil(r)}}at=!1}function dt(){var e=(Date.now()-E)/1e3;at&&D&&(K=e<.4?3:2,pt(D)),D=e;while(q.length)q.pop().remove();var n=!1;for(var r=0;r<o;++r){if(!y[r])continue;var u=e*g+ut[r],a=!0,f=1*(N[r]-ut[r])/g-M;N[r]<u&&(u=N[r]);var l=yt(r),h=k[l];if(!ut[r]){var p=Math.floor(u)+s+1+S;Y&&p>=N[r]&&(n=!0);for(var d=T[r];d<p;++d){var v=d-s-1;if(v<N[r]){++T[r];var m=gt(r,l,T[r]);t.setSymbol(m,h[v]),r==0&&tt++}}}if(e>=f){var C=ht(e-f);for(var O=x[r];O<=T[r];++O){var P=s+1,H=Math.floor((s-(O-(T[r]-P))+C)*c.h);R&&R[r]&&R[r][1]==s-(O-(T[r]-s))&&C>0&&(H=Math.floor((s-(O-(T[r]-P)))*c.h));if(F){var B="0,"+(H-A[r][O])+"px";I?L[r][O].css(F,"translate3d("+B+",0)"):L[r][O].css(F,"translate("+B+")")}else L[r][O].css("top",H+"px")}N[r]-ut[r]<=u&&!b[r]&&(X&&X(l),b[r]=!0);if(e>=f+_){var P=s+1;for(var j=x[r];j<=T[r];++j)if(j<T[r]-P)L[r][j].remove(),delete L[r][j],delete A[r][j];else if(T[r]>P){var U=j-(T[r]-P);L[r][j].attr("id","reel_"+l+"_"+U).css("z-index",1e3-(j-(T[r]-P))),L[r][U]=L[r][j],A[r][U]=A[r][j],delete L[r][j],delete A[r][j]}T[r]=P,x[r]=0,a=!1,L[r][0].hasClass("noScatter")&&L[r][0].css("opacity",0),L[r][P].hasClass("noScatter")&&L[r][P].css("opacity",0),y[r]=!1,w&&!w[r]&&(V&&V(l),w[r]=!0)}}else{var C=0;e>f-M&&(C=ht(e-(f-M)));for(var O=x[r];O<=T[r];++O){var H=Math.floor((s-O+(u-ut[r])+C)*c.h);if(F){var B="0,"+(H-A[r][O])+"px";I?L[r][O].css(F,"translate3d("+B+",0)"):L[r][O].css(F,"translate("+B+")")}else L[r][O].css("top",H+"px")}}if(!ut[r]&&a){var z=Math.ceil(u)-1;for(var $=x[r];$<u;++$){if($>T[r])break;$==z?q.push(L[r][$].removeAttr("id")):L[r][$].remove(),delete L[r][$],delete A[r][$],++x[r]}}}if(Y&&n){var J=i.getSymbols(Z);bt({symbols:J})}return y[o-1]?!0:(G=!1,W&&W(),!1)}function vt(e){if(!d){d=e[2];if(u[e[2]])for(var n=0;n<o;++n)for(var r in L[n])L[n][r].css("background-image").search(u[e[2]].src)!=-1&&L[n][r].addClass("bonusSymbol"+(r>5?5:r))}var r=s+1-e[1];t.setSymbol(L[e[0]][r],e[2]),L[e[0]][r].addClass("bonusSymbol"+(r>5?5:r))}function mt(){if(!B){B=null,J&&J();return}var e=Date.now();if(B.length)if(P)while(B.length)vt(B.shift()),j=e;else e-j>=220&&(vt(B.shift()),j+=220,n.play({playwhat:"stamp"}));return B.length>0?!0:e-j>=250?(B=null,J&&J(),!1):!0}function gt(e,t,n){typeof L[e][n]!="undefined"&&console.warn("a symbol already exists on reel "+e+" position "+n);var r=(s-n)*c.h,i=$("<div></div>").attr("id","reel_"+t+"_"+n).addClass("noScatter").css({position:"absolute",left:e*c.w+e*h+"px",top:r+"px",width:c.w+"px",height:c.h+"px","z-index":1e3-n});return l.append(i),L[e][n]=i,A[e][n]=r,i}function yt(e){return String.fromCharCode(f.charCodeAt(0)+e)}function bt(e){if(typeof e.symbols!="object"||!e.symbols)return;k||(k={});var n=N[0],r=typeof e.overwritePendingSymbols!="undefined"&&e.overwritePendingSymbols?tt:N[0];typeof e.overlap=="number"&&(r-=e.overlap);for(var i=0;i<o;++i){var s=yt(i);k[s]||(k[s]={});for(var u=r;u<n;u++){var a=u-r;typeof L[i][et+u]!="undefined"?t.setSymbol(L[i][et+u],e.symbols[s][a]):delete k[s][u],N[i]--}for(var a in e.symbols[s])a=parseInt(a),k[s][r+a]=e.symbols[s][a],N[i]++}}function wt(e){if(st>0){var t=st,n=yt(0),r=0;for(var o in e[n])r++;var u=r,a=s+2;typeof it=="function"&&(a=it()),u-=a,t>u&&(t=u);for(var f in e){var l=[];for(var c in e[f]){if(c<t)continue;l.push(e[f][c])}e[f]=l}}else if(st<0){var h=-st,p=i.getSlotface(h-1);for(var d in p){var f=yt(parseInt(d));p[d].push(i.getUncriticalSymbol(f));for(var c in e[f])p[d].push(e[f][c]);e[f]=p[d]}}}function Et(){K=1;var e=s+1;if(d)for(var n=1;n<=5;++n)$(".bonusSymbol"+n).removeClass("bonusSymbol"+n);ut=[0,0,0,0,0],x=[0,0,0,0,0],T=[e,e,e,e,e],E=Date.now(),G=!0,y=[!0,!0,!0,!0,!0],b=[!1,!1,!1,!1,!1],w&&(w=[!1,!1,!1,!1,!1]),at=P=d=!1,D=0,tt=0;for(var n=0;n<o;++n){L[n][0].css("opacity",0),L[n][e].css("opacity",1);var i=yt(n),u=k[i];for(var a=0;a<S;++a)if(a<N[n]){++T[n];var f=gt(n,i,T[n]);t.setSymbol(f,u[a]),n==0&&tt++}}r.add(Q.spin,dt)}var t=this,n=null,r=null,i=null,s=3,o=5,u={},a=0,f="a",l=!1,c=!1,h=0,p=[],d=!1,v=!1,m=!1,g=15,y=[!1,!1,!1,!1,!1],b=[!1,!1,!1,!1,!1],w=null,E=0,S=3,x=[0,0,0,0,0],T=[4,4,4,4,4],N=[0,0,0,0,0],C=!1,k=null,L=[[],[],[],[],[]],A=[[],[],[],[],[]],O=null,M=0,_=0,D=0,P=!1,H=null,B=null,j=0,F=!1,I=!1,q=[],R=null,U=!1,z=null,W=null,X=null,V=null,J=null,K=1,Q={spin:"spin",stamp:"stamp"},G=!1,Y=!1,Z=10,et=0,tt=0,nt=0,rt=[],it=null,st=0,ot=null,ut=[0,0,0,0,0],at=!1,ft={documentName:function(){return"reel"}};(function(e){n=e.sound,r=e.animManager,typeof e.placeholderTypes!="undefined"&&(v=!0),i=new ReelSymbolFaker({reels:e.fakeReels,symbols:e.fakeReelSymbols,criticalSymbols:e.fakeCriticalSymbols,placeholderTypes:e.placeholderTypes,possibleInitialPlaceholderSymbols:e.possibleInitialPlaceholderSymbols,reelReplacementFunction:typeof e.reelReplacementFunction=="function"?e.reelReplacementFunction:null}),typeof e.getRunThroughSymbolsAmountToKeepFromSpinresult=="function"&&(it=e.getRunThroughSymbolsAmountToKeepFromSpinresult);var t=null;typeof e.cache=="object"&&(t=e.cache);if(F=e.conf.getSupportedTransform())I=e.conf.use3DTransform();l=$("#"+e.container),c=e.size,h=e.reelSpace,typeof e.rows!="undefined"&&(s=e.rows,T=[s+1,s+1,s+1,s+1,s+1]),typeof e.reels!="undefined"&&(o=e.reels),typeof e.firstReel!="undefined"&&(f=e.firstReel,f!="a"&&(Q.spin+=f,Q.stamp+=f)),e.scatter&&(p=$.isArray(e.scatter)?e.scatter:[e.scatter]),e.speed&&(g=e.speed);var d=e.scatterParams?e.scatterParams:{h:"248px",m:"-39px"};typeof d[0]=="undefined"&&typeof d.h!="undefined"&&(d=[d]);var m=d[0];if(p.length>0){H={};for(var y in p){var b=p[y];H[b]=typeof d[b]!="undefined"?d[b]:m,typeof H[b].top=="undefined"&&(H[b].top=!1)}p.length>1&&(U=!0)}typeof e.finishListener!="undefined"&&e.finishListener&&(w=[!1,!1,!1,!1,!1]),typeof e.bounce!="undefined"?O=e.bounce:g==15?O=[[0,-0.1988],[.033333333,.111],[.066666667,.25125],[.1,.225],[.133333333,.12665],[.166666667,.0563],[.2,.01415],[.233333333,0]]:g==10?O=[[0,-0.162],[.066666667,.038],[.1,.15],[.133333333,.1713],[.166666667,.1188],[.2,.0668],[.233333333,.0299],[.266666667,0,62],[.3,0]]:O=[[0,.0138],[.033333333,.2064],[.066666667,.2251],[.1,.2766],[.133333333,.1266],[.166666667,.0562],[.2,.0141],[.233333333,0]],a=e.symbols.length;for(var y in e.symbols){var E=!1;if(t){var S=t.getCachedImg(e.symbols[y]);S&&(u[e.symbols[y]]=S,E=!0,--a)}if(!E){var S=new Image;S.addEventListener("load",lt,!1),S.src=jv_hypeSymbolPath+e.symbols[y],u[e.symbols[y]]=S}}_=O[O.length-1][0]})(e),this.init=function(){et=0;for(var e=0;e<o;++e){var t=yt(e);for(var n=0;n<s+2;++n)gt(e,t,n),e==0&&et++}},this.enforceLoaded=function(e){a<=0?e():z=e},this.initValues=function(e,n){m||(t.resetValues(n),m=!0);for(var r in n){var s=rt.length;rt[s]=[],rt[s].push(i.getUncriticalSymbol(s));for(var o in n[r])rt[s].push(n[r][o])}i.initPlaceholderSymbols(),i.checkForReelReplacementSymbols(n),t.enforceLoaded(e)},this.setSpinRuntimeCorrection=function(e){if(!e){st=0;return}st=Math.floor(g*e/1e3)},this.resetValues=function(e){for(var n=0;n<o;++n){var r=yt(n),i=e[r];for(var u=0;u<s+1;++u)t.setSymbol($("#reel_"+r+"_"+(u+1)),i[u]);L[n][0].hasClass("noScatter")&&L[n][0].css("opacity",0),L[n][s+1].hasClass("noScatter")&&L[n][s+1].css("opacity",0)}},this.startInfiniteSpin=function(e){if(G)return;W=e.onEnd||null,X=e.onReelStopped||null,V=e.onReelFinished||null,i.initReels(),k={},N=[0,0,0,0,0];var t=i.getSymbols(Z);bt({symbols:t}),ot||(ot=rt),Y=!0,Et()},this.stopInfiniteSpin=function(){Y=!1},this.setSpinResult=function(e,t,n){st&&wt(t.reelSymbols),Y=!1,W=e.onEnd,X=e.onReelStopped,V=e.onReelFinished,R=typeof n.dontBounce=="undefined"?!1:n.dontBounce,ot=n.quickStopData;if(!G)k={},N=[0,0,0,0,0],bt({symbols:t.reelSymbols,overwritePendingSymbols:!1});else{var r=3,u=yt(0),a=yt(o-1),f=0;for(var l in t.reelSymbols[u])f++;var c=s+2,h=-r;if(typeof it=="function"){var p=it();h+=f-p}else{h+=tt;var d=f-c;d<h&&(h=d)}h<0&&(h=0);var m={};countSpinresultSymbolsOnFirstReel=0,nt=0;for(reelID in t.reelSymbols){m[reelID]={};for(var l in t.reelSymbols[reelID])l>=h&&(m[reelID][l-h]=t.reelSymbols[reelID][l],reelID==u&&countSpinresultSymbolsOnFirstReel++,reelID==a&&nt++)}var g=i.checkTransitionOfSymbols(m),y=n.finishPositionData[0];countSpinresultSymbolsOnFirstReel==y.length&&g[0]&&(y[y.length-1]=g[0],typeof n.updateWinlinesBlending=="function"&&n.updateWinlinesBlending(),i.checkTransitionOfSymbols(ot)),bt({symbols:m,overwritePendingSymbols:!0,overlap:r})}C=t.prestamp,B=t.copySymbolsOnReels;if(v){var b={};if(typeof n.placeholderSymbols!="undefined")for(var w in n.placeholderSymbols)b[yt(parseInt(w))]=n.placeholderSymbols[w];i.setPlaceholderSymbols(b,t.reelSymbols)}G||Et()},this.quickStop=function(){Y&&(Y=!1),at=!0;if(R)for(var e=0;e<o;++e)b[e]||(R[e]=!1)},this.startStamping=function(e){J=e,j=Date.now();for(var n=0;n<o;++n)for(var i in C[n])C[n][i]&&t.setSymbol(L[n][i],C[n][i]);r.add(Q.stamp,mt)},this.stopStamping=function(){P=!0},this.startTimelineNamed=function(e){e!="anim_stamp"&&e=="stamp_stop"},this.setSymbol=function(e,t){var n=$.inArray(t,p)!=-1,r=!e.hasClass("noScatter");if(n){var i=r&&e.hasClass("topScatter");if(!r||U)H[t].w&&H[t].l?e.removeClass("noScatter").css({height:H[t].h,"margin-top":H[t].m,width:H[t].w,"margin-left":H[t].l}):e.removeClass("noScatter").css({height:H[t].h,"margin-top":H[t].m,width:c.w+"px","margin-left":0});H[t].top?i||e.addClass("topScatter"):i&&e.removeClass("topScatter")}else!n&&r&&e.addClass("noScatter").removeClass("topScatter").css({height:c.h+"px","margin-top":0,width:c.w+"px","margin-left":0});e.css("background-image","url("+u[t].src+")")},this.setSpinMode=function(e){typeof e!="undefined"&&i.setSpinMode(e)},this.setBonusSymbols=function(e){typeof e=="object"&&i.setBonusSymbols(e)},this.clearBonusSymbols=function(){i.clearBonusSymbols()},this.getLastReelRunThroughSymbolsCount=function(){return nt}};