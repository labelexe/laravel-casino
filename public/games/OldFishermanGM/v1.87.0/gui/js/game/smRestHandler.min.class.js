/**
 * class for common stuff for slot machine rest classes.
 * @copyright LoCoNET GmbH 2014-09-18
 */function SMRestHandler(e){function x(){if(l||f)return;f=!0,r&&r.soundOn()}function T(){if(!f)return;f=!1,r&&r.soundOff()}function N(){if(b){var e={reelClickAreaContainerPos:{left:84,top:128,width:716,height:386},reelClickAreaPos:{width:716,height:128},symbolClickAreaPos:{width:140,height:128},symbolClickAreaMargin:{"margin-left":4}},t={reelClickAreaContainerPos:{left:850,top:14,width:358,height:576},reelClickAreaPos:{width:358,height:64},symbolClickAreaPos:{width:70,height:64},symbolClickAreaMargin:{"margin-left":2}};C("reelClickAreaContainer",e),C("reelClickAreaContainerX",t)}else{if(m==3)var e={reelClickAreaContainerPos:{left:253,top:14,width:774,height:576},reelClickAreaPos:{width:774,height:192},symbolClickAreaPos:{width:234,height:192},symbolClickAreaMargin:{"margin-left":36}};else var e={reelClickAreaContainerPos:{left:107,top:14,width:1066,height:576},reelClickAreaPos:{width:1066,height:192},symbolClickAreaPos:{width:210,height:192},symbolClickAreaMargin:{"margin-left":4}};C("reelClickAreaContainer",e)}i.abortWinlineStepping(),a("getDataForManualReelsModus",{})}function C(e,t){$(".gameContainer").append('<div id="'+e+'"><div class="reelClickArea-up"></div><div class="reelClickArea-down"></div></div>');var n=$("#"+e),r=n.find(".reelClickArea-up"),i=n.find(".reelClickArea-down");n.css({position:"absolute",left:parseInt(y*t.reelClickAreaContainerPos.left)+"px",top:parseInt(y*t.reelClickAreaContainerPos.top)+"px",width:parseInt(y*t.reelClickAreaContainerPos.width)+"px",height:parseInt(y*t.reelClickAreaContainerPos.height)+"px"}),n.find('div[class^="reelClickArea-"]').css({position:"absolute",width:parseInt(y*t.reelClickAreaPos.width)+"px",height:parseInt(y*t.reelClickAreaPos.height)+"px"}),r.css({top:"0px"}),i.css({bottom:"0px"});for(var s=0;s<m;s++)r.append('<div class="symbolClickArea fl" id="symbolClickArea-up-'+w+'"></div>'),i.append('<div class="symbolClickArea fl" id="symbolClickArea-down-'+w+'"></div>'),w++;var o=n.find(".symbolClickArea");n.find('div[class^="reelClickArea-"]').append('<div class="clear"></div>'),o.css({position:"relative",width:parseInt(y*t.symbolClickAreaPos.width)+"px",height:parseInt(y*t.symbolClickAreaPos.height)+"px","z-index":50,cursor:"pointer"}),n.find(".symbolClickArea + .symbolClickArea").css({"margin-left":parseInt(y*t.symbolClickAreaMargin["margin-left"])+"px"}),o.click(L)}function k(){$("#reelClickAreaContainer").remove(),b&&$("#reelClickAreaContainerX").remove(),p={}}function L(){var e=$(this).attr("id").split("-"),t=e[1],n=e[2],r=p.positions[n];t=="up"?r=r>0?r-1:p.reelSizes[n]-1:t=="down"&&(r=r<p.reelSizes[n]-1?r+1:0),p.positions[n]=r,A()}function A(){w=0;var e=function(e,t,n,r){var i=[];for(var s=0;s<m;s++)i[s]=t[s];for(var s in i){var o=p.positions[w],u=p.reelSizes[w];for(var a=0;a<r;a++)e.setSymbol($("#reel_"+i[s]+"_"+(r-a)),g[n][p.reelset[w][(u+o-a)%u]]);e.setSymbol($("#reel_"+i[s]+"_0"),g[n][1]),e.setSymbol($("#reel_"+i[s]+"_"+(r+1)),g[n][1]),w++}},t="base";p.freegame&&(t=p.freegameType==1?"free":"free"+p.freegameType),e(s,["a","b","c","d","e"],t,d),b&&(t="x"+t,e(o,["f","g","h","i","j"],t,v))}var t=this,n=null,r=null,i=null,s=null,o=null,u=!1,a,f=!0,l=!1,c=-1,h=!1,p={},d=3,v=0,m=5,g={},y=1,b=!1,w=0,E=null,S=null;this.processResponse=function(e){typeof e.redirect!="undefined"&&(window.location.href=e.redirect),typeof e.reload!="undefined"&&e.reload&&window.location.reload(),typeof e.lablerData!="undefined"&&n&&n.prepare(e.lablerData),typeof e.manualReelsData!="undefined"&&(p=e.manualReelsData,A())},this.onActionDone=function(){n&&n.run()},this.onSMReady=function(){$(".container").addClass("loaded"),$("#loading").remove(),t.onActionDone()},this.onFatalError=function(){E!==null?E():window.location.reload()},this.onSoundLoaded=function(e){!n&&!e&&(T(),$(".soundButton").addClass("soundOff").removeClass("soundOn")),f||r.soundOff(),u&&$(".soundButton").click(function(){f?(T(),$(".soundButton").addClass("soundOff").removeClass("soundOn"),a("setSound",{sound:0})):(r.playGeneric("buttonClick"),x(),$(".soundButton").addClass("soundOn").removeClass("soundOff"),a("setSound",{sound:1}))});if(bowser.name.toLowerCase()=="firefox"){$(".selectBoxes").detach().appendTo("body").removeClass().addClass("selectBoxes mozillaBugfix").css("left",$(window).width()/2-103+"px");var t=$(window).height();parseInt($(".selectBoxes").css("top"))>t*.84&&$(".selectBoxes").css("top",Math.floor(t*.84)+"px")}},this.enableManualReels=function(e){i=e.anim,s=e.reelEngine,o=e.xReelEngine,g=e.reelSymbols,typeof e.rows!="undefined"&&(d=e.rows),typeof e.xRows!="undefined"&&(v=e.xRows),typeof e.reels!="undefined"&&(m=e.reels),typeof e.halfsize!="undefined"&&e.halfsize&&(y=.5),typeof e.xtremeSlot!="undefined"&&(b=e.xtremeSlot);var t=typeof e.hasFirepot!="undefined"?e.hasFirepot:!1;$("#cheatModus").size()&&($("#cheatModus").change(function(){$("#cheatModus").val()=="-1"?(w=0,N()):k()}),$("body").keypress(function(e){e.which==99&&!e.metaKey&&!e.ctrlKey&&($(".gameContainer .fps").toggle(),$(".gambleBox.gambleCard").is(":visible")&&$(".gambleCheats.cardCheats").toggle(),$(".gambleBox.gambleLadder").is(":visible")?$(".gambleCheats.ladderCheats").toggle():($(".slotCheats,.freeRoundCheats").toggle(),t&&$(".jackpotCheats").toggle()))}))},this.onMoneySet=function(e){c!=e&&(n&&n.setMoney(e),c=e)},this.isResizable=function(){return n?n.isResizable():!0},this.addRequestParams=function(e,t){e.m=jv_sMode,t=="spin"&&(typeof p.positions!="undefined"&&(e.manualReelsPositions=JSON.stringify(p.positions)),k());if(n)return n.addRequestParams(e)},this.addCallbacks=function(e){n&&(typeof e.deactivateAutoSpin=="function"&&n.addCallback("deactivateAutoSpin",e.deactivateAutoSpin),typeof e.setLineBets=="function"&&n.addCallback("setLineBets",e.setLineBets),typeof e.abortWinAnim=="function"&&n.addCallback("abortWinAnim",e.abortWinAnim),typeof e.getState=="function"&&n.addCallback("getState",e.getState),typeof e.pauseSlot=="function"&&n.addCallback("pauseSlot",e.pauseSlot),typeof e.resumeSlot=="function"&&n.addCallback("resumeSlot",e.resumeSlot),typeof e.afterFreeRoundsIntro=="function"&&n.addCallback("afterFreeRoundsIntro",e.afterFreeRoundsIntro),typeof e.ignoreUserInput=="function"&&n.addCallback("ignoreUserInput",e.ignoreUserInput),n.addCallback("requestSender",a))},this.onPreloaderUpdate=function(e,t){var r=Math.floor(e*100/(t-2));r>=100&&($("#loading .state").show(),r=100),$("#loading .progress").html(r+"%"),n&&typeof n.onPreloaderUpdate=="function"&&n.onPreloaderUpdate(Math.floor(e*100/t))},this.requestInit=function(){h?setTimeout(function(){a("init",{},t.requestInit)},300):(h=!0,a("init",{},t.requestInit))},this.onExternalRequest=function(e){n&&typeof n.onExternalRequest=="function"?n.onExternalRequest(e):console.log("can not handle external request!")},this.loadSoundManager=function(e){var t={soundfiles:e.soundFiles,plusSound:e.smallSounds==="plus",soundOn:!0,version:e.soundFileVersion,onProgress:e.onProgress,soundVersions:e.soundVersions};return e.soundVersions.length?r=new SoundManager(t):(jv_isSoundSettable=!1,$(".soundButton").remove(),r=new SoundFaker(t)),r.setDefaultSoundLine("fg2"),r},this.getSoundFiles=function(e,t){var n={},r=t?t:"normal",i=r=="optimal"||r=="plus";for(var s in e){var o=e[s].format,u=!1;typeof o=="object"?(o=$.map(o,function(e,t){return[e]}),u=$.inArray(r,o)!=-1):u=o==r,u&&(i?n[s.substring(0,s.length-1)]=e[s]:n[s]=e[s])}return n},this.onCloseGame=function(){r.stopBgSound(),r.stop("fg1"),r.stop("fg2")},this.onNoMoney=function(){n&&typeof n.onNoMoney=="function"&&n.onNoMoney()},this.onGameEvent=function(e){n&&typeof n.onGameEvent=="function"&&n.onGameEvent(e)},this.showClock=function(){$(".console").append('<div class="clockDisplay"></div>'),S=$(".console .clockDisplay");var e=function(){var e=new Date,t=e.getHours(),n=e.getMinutes();S.html(t+":"+(n<10?"0":"")+n)};setInterval(e,1e4),e()},this.renderPaytable=function(e){var t=$(".infoContainer .infoPopup"),n=e.resolution==1280?2:1;if(!t.length||t.hasClass("info2")){$(".infoContainer").html(e.paytableHTML),typeof e.maxLines!="undefined"&&$(".infoContainer .paylines").addClass("lines-"+e.maxLines);var r=$(".infoContainer .infoPopup #jackpotWinValues");if(r.length){r.css({position:"absolute"});var i=r.width();r.css({width:i+n*4,position:""}),r.find(".topWinOnHighestLevel").remove()}typeof e.onRendered=="function"&&e.onRendered()}else t.find(".winValueBox").each(function(){var t=$(this),n=$(e.paytableHTML).find("#"+t.attr("id"));n.length&&(n.find(".topWinOnHighestLevel").remove(),t.html(n.html()))});var s=1;return $(".infoPopup .widthReference").each(function(){var e=$(this),t=e.find(".multiplicator").outerWidth()+8*n,r=e.width()-t;e.width("auto");var i=e.width()-t;e.width("");if(i>r){var o=r/i;o<s&&(s=o)}}),s<1&&$(".infoPopup .winValueText").each(function(){var e=$(this),t=parseInt(e.css("font-size"));e.css("font-size",parseInt(t*s)+"px");var n=parseInt(e.css("padding-left"));n&&e.css("padding-left",parseInt(n*s+.5)+"px")}),typeof e.onFinished=="function"&&e.onFinished(),!0},function(e){typeof Labler!="undefined"&&(n=new Labler({switchSound:function(e){e?x():T()},setSoundSetting:function(e){l=!e},lablerEventManager:e.lablerEventManager})),a=e.requestSender,u=e.isSoundSettable,typeof e.onFatalError=="function"&&(E=e.onFatalError);var r=e.clock,i=e.version,s=e.name,o=s.toLowerCase().replace(/\s/g,""),f=o.replace("&","and"),c=i.toLowerCase().replace(/\s/g,"");c.indexOf(o)==-1&&c.indexOf(f)==-1&&(i=" "+i),console.log(i);if(r||i){var h=$(".console");r&&t.showClock(),i&&(h.append('<div class="versionDisplay"><span class="slotName hidden">'+s+"</span>"+'<span class="slotVersion hidden">'+i+"</span>"+"</div>"),showSlotSessionStatistics=!0,showSlotSessionStatistics&&$(".console .versionDisplay").append('<span class="slotSessionStats hidden">'+obj_lang.game_onlineConsole_slotSessionStats+"</span>"))}var p=typeof e.warnBrowser!="undefined"&&e.warnBrowser;if(p){var d=$("#errorPopupCode .errorContainer").clone();d.appendTo($(".popupContainer")),$(".popupContainer .errorText").html(obj_lang.game_error_useChrome),$(".popupContainer .reconnectButton").remove(),$(".popupContainer .retry").click(function(){return $(".popupContainer").html(""),!1})}}(e)};